<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>HUY GYM ‚Äî Qu·∫£n L√Ω H·ªçc Vi√™n</title>

<!-- PWA Meta Tags -->
<meta name="application-name" content="HUY GYM"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="default"/>
<meta name="apple-mobile-web-app-title" content="HUY GYM"/>
<meta name="mobile-web-app-capable" content="yes"/>
<meta name="theme-color" content="#6c47ff"/>
<meta name="description" content="·ª®ng d·ª•ng qu·∫£n l√Ω h·ªçc vi√™n ph√≤ng gym v·ªõi Firebase sync"/>

<!-- PWA Manifest -->
<link rel="manifest" href="manifest.json"/>

<!-- Apple Touch Icons -->
<link rel="apple-touch-icon" href="icons/icon-152.png"/>
<link rel="apple-touch-icon" sizes="72x72"  href="icons/icon-72.png"/>
<link rel="apple-touch-icon" sizes="96x96"  href="icons/icon-96.png"/>
<link rel="apple-touch-icon" sizes="128x128" href="icons/icon-128.png"/>
<link rel="apple-touch-icon" sizes="144x144" href="icons/icon-144.png"/>
<link rel="apple-touch-icon" sizes="152x152" href="icons/icon-152.png"/>
<link rel="apple-touch-icon" sizes="192x192" href="icons/icon-192.png"/>

<!-- Favicon -->
<link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png"/>
<link rel="icon" type="image/png" sizes="32x32"   href="icons/icon-96.png"/>

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>

<style>
:root{
  --bg-app:#f4f6fb;
  --bg-sidebar:#ffffff;
  --bg-card:#ffffff;
  --bg-input:#f8f9fc;
  --bg-hover:#f0f3fa;
  --border:#e5e9f2;
  --border2:#d0d7e8;

  --purple:#6c47ff;
  --purple-soft:rgba(108,71,255,.09);
  --purple-mid:rgba(108,71,255,.18);
  --purple-dark:#5235d4;

  --green:#0ea868;
  --green-soft:rgba(14,168,104,.1);
  --orange:#f59e0b;
  --orange-soft:rgba(245,158,11,.1);
  --red:#ef4444;
  --red-soft:rgba(239,68,68,.1);
  --gray:#64748b;
  --gray-soft:rgba(100,116,139,.1);

  --t0:#0f172a;
  --t1:#475569;
  --t2:#94a3b8;
  --t3:#cbd5e1;

  --fh:'Plus Jakarta Sans',sans-serif;
  --fb:'DM Sans','Segoe UI',sans-serif;
  --r:10px;--rl:14px;
  --sw:220px;
}
*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%;background:var(--bg-app);color:var(--t0);font-family:var(--fb);overflow:hidden}

::-webkit-scrollbar{width:5px;height:5px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--border2);border-radius:99px}
::-webkit-scrollbar-thumb:hover{background:var(--t2)}

/* ‚îÄ‚îÄ Layout ‚îÄ‚îÄ */
.app{display:flex;height:100vh}

/* ‚ïê‚ïê SIDEBAR ‚ïê‚ïê */
.sidebar{
  width:var(--sw);min-width:var(--sw);
  background:var(--bg-sidebar);border-right:1px solid var(--border);
  display:flex;flex-direction:column;overflow:hidden;
}
.logo{padding:18px 16px 14px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:10px}
.logo-icon{
  width:38px;height:38px;border-radius:11px;
  background:linear-gradient(135deg,#6c47ff,#9b6fff);
  display:flex;align-items:center;justify-content:center;
  font-size:20px;flex-shrink:0;
  box-shadow:0 4px 14px rgba(108,71,255,.32);
}
.logo-name{font-family:var(--fh);font-size:15px;font-weight:800;color:var(--t0)}
.logo-sub{font-size:10px;color:var(--t2);margin-top:1px}
.nav{flex:1;padding:8px 10px;overflow-y:auto;display:flex;flex-direction:column;gap:1px}
.nav-sec{padding:10px 8px 4px;font-size:9.5px;color:var(--t2);letter-spacing:1.5px;text-transform:uppercase;font-weight:700}
.nv{
  display:flex;align-items:center;gap:9px;padding:8px 10px;
  cursor:pointer;transition:all .15s;border-radius:8px;
  font-size:13px;color:var(--t1);font-weight:500;
}
.nv:hover{background:var(--bg-hover);color:var(--t0)}
.nv.active{background:var(--purple-soft);color:var(--purple);font-weight:600}
.nv .ni{font-size:15px;width:20px;text-align:center;flex-shrink:0;color:var(--t2);transition:color .15s}
.nv:hover .ni{color:var(--t0)}
.nv.active .ni{color:var(--purple)}
.sf{padding:14px 16px;border-top:1px solid var(--border)}
.clock{font-family:var(--fh);font-size:13px;color:var(--t0);font-weight:700}
.clock-d{font-size:10px;color:var(--t2);margin-top:2px}
.fb-status{display:flex;align-items:center;gap:5px;font-size:10px;color:var(--t2);margin-top:6px}
.fb-dot{width:6px;height:6px;border-radius:50%;background:var(--t3);flex-shrink:0;transition:background .3s}
.fb-dot.online{background:var(--green);animation:p2 2s ease infinite}
.fb-dot.syncing{background:var(--orange);animation:p2 .8s ease infinite}
.fb-dot.error{background:var(--red)}
@keyframes p2{0%,100%{opacity:1}50%{opacity:.3}}
.ver{font-size:9px;color:var(--t3);margin-top:4px}

/* ‚îÄ‚îÄ Main ‚îÄ‚îÄ */
.main{flex:1;display:flex;flex-direction:column;min-width:0;min-height:0;overflow:hidden}

/* ‚îÄ‚îÄ Topbar ‚îÄ‚îÄ */
.topbar{
  background:#fff;border-bottom:1px solid var(--border);
  padding:0 24px;height:56px;display:flex;align-items:center;gap:12px;flex-shrink:0;
}
.bc{font-family:var(--fh);font-size:15px;font-weight:700;color:var(--t0)}
.bc span{color:var(--t2);font-weight:400;font-family:var(--fb);font-size:12px;margin-left:4px}

/* PWA install banner */
#pwa-banner{
  display:none;align-items:center;gap:10px;
  background:linear-gradient(90deg,#6c47ff,#9b6fff);
  padding:8px 20px;font-size:12px;color:#fff;flex-shrink:0;
}
#pwa-banner.show{display:flex}
#pwa-banner b{font-weight:700}
.pwa-install-btn{
  margin-left:auto;background:rgba(255,255,255,.2);border:1px solid rgba(255,255,255,.4);
  color:#fff;padding:4px 12px;border-radius:99px;font-size:11.5px;font-weight:600;cursor:pointer;
  transition:background .15s;font-family:var(--fb);flex-shrink:0;
}
.pwa-install-btn:hover{background:rgba(255,255,255,.35)}
.pwa-dismiss-btn{background:none;border:none;color:rgba(255,255,255,.6);cursor:pointer;font-size:16px;padding:0 4px;flex-shrink:0}

.sw{margin-left:auto;position:relative;flex-shrink:0}
.sw input{
  background:var(--bg-input);border:1.5px solid var(--border);color:var(--t0);
  font-family:var(--fb);font-size:13px;
  padding:7px 14px 7px 36px;border-radius:99px;width:230px;outline:none;transition:all .2s;
}
.sw input:focus{border-color:var(--purple);box-shadow:0 0 0 3px rgba(108,71,255,.1);background:#fff}
.sw input::placeholder{color:var(--t2)}
.si{position:absolute;left:12px;top:50%;transform:translateY(-50%);color:var(--t2);font-size:14px;pointer-events:none}

/* ‚îÄ‚îÄ Pages ‚îÄ‚îÄ */
.page{flex:1;display:none;flex-direction:column;min-height:0;overflow:hidden}
.page.active{display:flex}

/* ‚îÄ‚îÄ STAT CARDS (top row) ‚îÄ‚îÄ */
.sb{display:flex;gap:10px;padding:16px 24px 0;flex-shrink:0;flex-wrap:wrap}
.sc{
  flex:1;min-width:120px;background:#fff;border:1.5px solid var(--border);
  border-radius:var(--rl);padding:12px 14px;
  display:flex;align-items:center;gap:12px;
  transition:all .2s;cursor:default;
}
.sc:hover{border-color:var(--c,var(--purple));box-shadow:0 4px 16px rgba(0,0,0,.06);transform:translateY(-1px)}
.sc-icon{
  width:40px;height:40px;border-radius:10px;
  background:var(--ci,var(--purple-soft));
  display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0;
}
.sc-body{}
.sl{font-size:10px;color:var(--t2);text-transform:uppercase;letter-spacing:.8px;font-weight:600}
.sv{font-family:var(--fh);font-size:24px;font-weight:800;color:var(--c,var(--purple));line-height:1.1;margin-top:1px}

/* ‚îÄ‚îÄ Table Area ‚îÄ‚îÄ */
.ta{flex:1;overflow:hidden;display:flex;flex-direction:column;padding:12px 24px 16px;min-height:0;gap:12px}

/* ‚îÄ‚îÄ Filter Bar ‚îÄ‚îÄ */
.filter-bar{
  display:flex;align-items:center;gap:8px;flex-shrink:0;flex-wrap:wrap;
  background:#fff;border:1.5px solid var(--border);border-radius:var(--r);
  padding:10px 14px;
}
.fbar-title{font-family:var(--fh);font-size:13px;font-weight:700;color:var(--t0)}
.fsep{width:1px;height:18px;background:var(--border);flex-shrink:0}
.btn{
  display:inline-flex;align-items:center;gap:5px;
  padding:6px 13px;border-radius:8px;border:1.5px solid transparent;cursor:pointer;
  font-family:var(--fb);font-size:12.5px;font-weight:600;transition:all .15s;white-space:nowrap;
}
.btn:active{transform:scale(.96)}
.bp{background:var(--purple);color:#fff;border-color:var(--purple)}.bp:hover{background:var(--purple-dark);box-shadow:0 4px 12px rgba(108,71,255,.28)}
.bs{background:#fff;color:var(--t1);border-color:var(--border)}.bs:hover{border-color:var(--purple);color:var(--purple);background:var(--purple-soft)}
.bd{background:#fff;color:var(--red);border-color:var(--border)}.bd:hover{border-color:var(--red);background:var(--red-soft)}
.bg{background:#fff;color:var(--green);border-color:var(--border)}.bg:hover{border-color:var(--green);background:var(--green-soft)}
.bo{background:#fff;color:var(--orange);border-color:var(--border)}.bo:hover{border-color:var(--orange);background:var(--orange-soft)}
.ml-a{margin-left:auto}
.hint-t{font-size:11px;color:var(--t2)}

/* Filter chips */
.chip{
  padding:5px 12px;border-radius:99px;border:1.5px solid var(--border);
  background:#fff;font-size:12px;font-weight:600;color:var(--t1);
  cursor:pointer;transition:all .15s;white-space:nowrap;
}
.chip:hover,.chip.active{border-color:var(--purple);color:var(--purple);background:var(--purple-soft)}

/* ‚îÄ‚îÄ Table ‚îÄ‚îÄ */
.tw{flex:1;overflow:auto;border:1.5px solid var(--border);border-radius:var(--rl);background:#fff;min-height:0}
table{width:100%;border-collapse:collapse;font-size:13px}
thead{position:sticky;top:0;z-index:5}
thead th{
  background:#fff;padding:10px 14px;text-align:left;
  font-family:var(--fh);font-size:10px;font-weight:700;
  color:var(--t2);text-transform:uppercase;letter-spacing:1.5px;
  border-bottom:1.5px solid var(--border);cursor:pointer;white-space:nowrap;user-select:none;transition:color .15s;
}
thead th:hover,thead th.sorted{color:var(--purple)}
thead th .sa{opacity:.35;margin-left:2px;font-size:8px}
thead th.sorted .sa{opacity:1}
tbody tr{border-bottom:1px solid var(--border);transition:background .12s;animation:rwIn .2s ease both}
@keyframes rwIn{from{opacity:0;transform:translateY(2px)}to{opacity:1;transform:none}}
tbody tr:hover{background:var(--bg-hover)}
td{padding:10px 14px;white-space:nowrap;vertical-align:middle;color:var(--t1)}

/* Avatar */
.av-cell{display:flex;align-items:center;gap:10px}
.avatar{
  width:36px;height:36px;border-radius:50%;
  background:linear-gradient(135deg,var(--purple-soft),var(--purple-mid));
  display:flex;align-items:center;justify-content:center;
  font-family:var(--fh);font-size:12px;font-weight:700;color:var(--purple);flex-shrink:0;
  border:1.5px solid var(--purple-mid);
}
.av-name{font-weight:600;color:var(--t0);font-size:13px}
.av-sub{font-size:11px;color:var(--t2);margin-top:1px}

/* Badges */
.badge{display:inline-flex;align-items:center;gap:4px;padding:3px 10px;border-radius:99px;font-size:11px;font-weight:600}
.ba{background:var(--green-soft);color:var(--green);border:1px solid rgba(14,168,104,.2)}
.bw{background:var(--orange-soft);color:var(--orange);border:1px solid rgba(245,158,11,.2)}
.be{background:var(--red-soft);color:var(--red);border:1px solid rgba(239,68,68,.2)}
.bp2{background:var(--gray-soft);color:var(--gray);border:1px solid rgba(100,116,139,.2)}

/* Action icons */
.act-cell{display:flex;align-items:center;gap:4px}
.act-btn{
  width:30px;height:30px;border-radius:7px;border:1.5px solid var(--border);
  background:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;
  font-size:13px;color:var(--t2);transition:all .15s;
}
.act-btn:hover{border-color:var(--purple);color:var(--purple);background:var(--purple-soft)}
.act-btn.del:hover{border-color:var(--red);color:var(--red);background:var(--red-soft)}

td.nc{color:var(--green)}td.oc{color:var(--orange)}td.rc{color:var(--red)}
td.num{text-align:center;font-weight:700;font-family:var(--fh)}
tr.sel-row{outline:1.5px solid rgba(108,71,255,.4);outline-offset:-1px}
tr.sel-row td{background:rgba(108,71,255,.04)!important}

.empty-st{display:flex;flex-direction:column;align-items:center;padding:64px;color:var(--t2);gap:10px}
.empty-st .ei{font-size:52px;opacity:.15}

/* ‚ïê‚ïê SCROLL PAGES ‚ïê‚ïê */
.scroll-page{flex:1;overflow-y:auto;overflow-x:clip;padding:20px 24px 24px;display:flex;flex-direction:column;gap:14px;min-height:0}

/* Section card */
.s-card{background:#fff;border:1.5px solid var(--border);border-radius:var(--rl);overflow:visible}
.s-card-hdr{padding:14px 18px;border-bottom:1.5px solid var(--border);display:flex;align-items:center;gap:10px}
.s-card-title{font-family:var(--fh);font-size:13.5px;font-weight:700;color:var(--t0);flex:1}
.s-card-badge{background:var(--bg-input);border:1px solid var(--border2);border-radius:99px;padding:2px 10px;font-size:11px;font-weight:600;color:var(--t1)}

/* Summary pills */
.sum-pills{display:grid;grid-template-columns:repeat(auto-fit,minmax(130px,1fr));gap:8px;padding:14px 16px}
.sum-pill{
  display:flex;flex-direction:column;align-items:center;
  border-radius:12px;padding:14px 8px 12px;
  border:1.5px solid;
  transition:all .18s;cursor:default;text-align:center;
}
.sum-pill:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(0,0,0,.08)}
.sum-pill .sp-num{font-family:var(--fh);font-size:28px;font-weight:800;line-height:1.1}
.sum-pill .sp-label{font-size:10px;font-weight:700;letter-spacing:.6px;text-transform:uppercase;margin-top:5px;opacity:.85;line-height:1.3}
.sum-pill .sp-sub{font-size:9.5px;margin-top:3px;opacity:.55;font-weight:500}

/* TK table */
.tkt{width:100%;border-collapse:collapse;font-size:12.5px}
.tkt th{padding:9px 14px;text-align:left;color:var(--t2);text-transform:uppercase;letter-spacing:1px;font-size:9.5px;background:var(--bg-app);font-weight:700;white-space:nowrap;border-bottom:1.5px solid var(--border)}
.tkt th:not(:first-child){text-align:center}
.tkt td{padding:10px 14px;border-top:1px solid var(--border);white-space:nowrap;color:var(--t1)}
.tkt td:not(:first-child){text-align:center}
.tkt tr:hover td{background:var(--bg-hover)}
.tkt .tr td{background:rgba(108,71,255,.04);font-weight:700;border-top:2px solid var(--border2)}
.na{color:var(--green);font-weight:600}.nw{color:var(--orange);font-weight:600}.ne{color:var(--red);font-weight:600}.np{color:var(--gray)}.nt{color:var(--purple);font-weight:700}

/* Revenue bar */
.rev-row{display:flex;align-items:center;gap:10px;margin-bottom:7px}
.rev-lbl{width:60px;font-size:10.5px;color:var(--t1);text-align:right;flex-shrink:0;font-weight:600}
.rev-track{flex:1;height:22px;background:var(--bg-input);border-radius:7px;overflow:hidden;border:1px solid var(--border)}
.rev-bar{height:100%;border-radius:7px;display:flex;align-items:center;padding-left:8px;font-size:10px;font-weight:700;color:#fff;white-space:nowrap;overflow:hidden;transition:width 1.1s cubic-bezier(.34,1.1,.64,1);width:0%;background:linear-gradient(90deg,#6c47ff,#9b6fff)}
.rev-val{width:105px;text-align:right;font-size:11px;font-weight:600;color:var(--t0);flex-shrink:0}

/* Alert card */
.alert-card{cursor:pointer;transition:all .2s}
.alert-card:hover{transform:translateY(-2px);box-shadow:0 8px 28px rgba(0,0,0,.08)}

/* Bi·∫øn ƒë·ªông */
.bd-member{display:flex;align-items:center;gap:12px;padding:11px 16px;border-bottom:1px solid var(--border);transition:background .12s}
.bd-member:hover{background:var(--bg-hover)}
.bd-member:last-child{border-bottom:none}
.bd-avatar{width:34px;height:34px;border-radius:50%;background:var(--purple-soft);display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;color:var(--purple);flex-shrink:0;border:1.5px solid var(--purple-mid)}
.bd-name{font-weight:600;font-size:13px;color:var(--t0);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;cursor:pointer;text-decoration:underline;text-underline-offset:2px;text-decoration-color:rgba(108,71,255,.3);transition:color .15s}
.bd-name:hover{color:var(--purple)}
.kpi-card{flex:1;background:#fff;border:1.5px solid var(--border);border-radius:var(--r);padding:16px 18px;position:relative;overflow:hidden}
.kpi-card::before{content:'';position:absolute;top:0;left:0;bottom:0;width:4px;background:var(--kc,var(--purple))}

/* ‚îÄ‚îÄ Status bar ‚îÄ‚îÄ */
.statusbar{background:#fff;border-top:1.5px solid var(--border);padding:5px 24px;display:flex;align-items:center;gap:8px;font-size:11px;color:var(--t2);flex-shrink:0}
.sd{width:6px;height:6px;border-radius:50%;background:var(--green);animation:p2 2s ease infinite;flex-shrink:0}
.sm{flex:1;color:var(--t1)}

/* ‚îÄ‚îÄ Modals ‚îÄ‚îÄ */
.mbk{position:fixed;inset:0;background:rgba(15,23,42,.5);backdrop-filter:blur(8px);z-index:100;display:none;align-items:center;justify-content:center}
.mbk.show{display:flex}
.modal{background:#fff;border:1.5px solid var(--border);border-radius:16px;width:540px;max-width:95vw;max-height:90vh;box-shadow:0 20px 60px rgba(15,23,42,.14);animation:su .22s cubic-bezier(.34,1.5,.64,1);position:relative;display:flex;flex-direction:column;overflow:hidden}
@keyframes su{from{opacity:0;transform:translateY(12px) scale(.97)}to{opacity:1;transform:none}}
.modal::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,#6c47ff,#9b6fff);z-index:1}
.mh{padding:16px 20px 13px;display:flex;align-items:center;gap:10px;border-bottom:1.5px solid var(--border);flex-shrink:0}
.mt{font-family:var(--fh);font-size:14px;font-weight:700;flex:1;color:var(--t0)}
.mc{background:none;border:none;color:var(--t2);cursor:pointer;font-size:16px;padding:4px;border-radius:6px;width:28px;height:28px;display:flex;align-items:center;justify-content:center;transition:all .15s}
.mc:hover{background:var(--bg-hover);color:var(--t0)}
.mb2{padding:16px 20px;overflow-y:auto;flex:1;min-height:0}
.mf2{padding:12px 20px;display:flex;gap:8px;justify-content:flex-end;border-top:1.5px solid var(--border);flex-shrink:0}
.fg{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.fgi{display:flex;flex-direction:column;gap:5px}
.fgi.full{grid-column:1/-1}
.fl{font-size:10.5px;font-weight:700;color:var(--t1);text-transform:uppercase;letter-spacing:1px}
.fi,.fs{background:var(--bg-input);border:1.5px solid var(--border);color:var(--t0);font-family:var(--fb);font-size:13px;padding:8px 12px;border-radius:8px;outline:none;transition:all .2s;width:100%}
.fi:focus,.fs:focus{border-color:var(--purple);box-shadow:0 0 0 3px rgba(108,71,255,.1);background:#fff}
.fi::placeholder{color:var(--t2)}
.fs option{background:#fff}
.am-modal .modal{width:510px}
.am-row{display:flex;align-items:center;gap:12px;padding:11px 18px;border-bottom:1px solid var(--border);transition:background .12s}
.am-row:last-child{border-bottom:none}
.am-row:hover{background:var(--bg-hover)}
.cm .modal{width:360px}
.cb{text-align:center;padding:28px 20px 14px}

/* Toast */
.toast{position:fixed;bottom:22px;right:22px;z-index:999;background:#fff;border:1.5px solid var(--border);border-radius:12px;padding:11px 16px;display:flex;align-items:center;gap:10px;box-shadow:0 8px 32px rgba(15,23,42,.12);font-size:13px;animation:ti .28s cubic-bezier(.34,1.5,.64,1);color:var(--t0)}
@keyframes ti{from{opacity:0;transform:translateY(7px) scale(.95)}to{opacity:1;transform:none}}
.toast.hide{animation:to2 .25s ease forwards}
@keyframes to2{to{opacity:0;transform:translateY(5px)}}
.tob{position:absolute;top:0;left:0;bottom:0;width:4px;border-radius:12px 0 0 12px}

@keyframes cu{from{transform:scale(1.18);opacity:.6}to{transform:none;opacity:1}}
.cu{animation:cu .3s ease}

/* Loading */
.loading-overlay{position:fixed;inset:0;background:rgba(255,255,255,.96);backdrop-filter:blur(4px);z-index:150;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:14px}
.loading-overlay.hidden{display:none}
.spinner{width:42px;height:42px;border:3px solid var(--border);border-top-color:var(--purple);border-radius:50%;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}

/* Offline banner */
#offline-bar{display:none;background:#fef3c7;border-bottom:1px solid #fcd34d;padding:6px 20px;font-size:12px;color:#92400e;align-items:center;gap:6px;flex-shrink:0}
#offline-bar.show{display:flex}

/* ‚ïê‚ïê GMAIL-STYLE COMPOSE BUTTON ‚ïê‚ïê */
.bn-compose{
  display:flex;align-items:center;gap:10px;
  background:#e8f0fe;
  border-radius:18px;
  padding:14px 22px;
  cursor:pointer;
  box-shadow:0 2px 8px rgba(108,71,255,.18);
  transition:all .18s;
  user-select:none;
  margin:0 8px;
  flex-shrink:0;
}
.bn-compose:hover{background:#d4e3fc;box-shadow:0 4px 16px rgba(108,71,255,.28)}
.bn-compose:active{transform:scale(.95)}
.bn-compose-icon{font-size:20px;line-height:1}
.bn-compose-label{
  font-family:var(--fh);font-size:14px;font-weight:700;
  color:#1a1a2e;white-space:nowrap;
}

/* Sidebar compose button */
.nv-compose{
  display:flex;align-items:center;gap:10px;
  margin:10px 10px 4px;
  padding:12px 16px;
  background:#e8f0fe;
  border-radius:14px;
  cursor:pointer;
  font-size:13.5px;font-weight:700;
  color:#1a1a2e;
  box-shadow:0 2px 8px rgba(108,71,255,.15);
  transition:all .18s;
}
.nv-compose:hover{background:#d4e3fc;box-shadow:0 4px 14px rgba(108,71,255,.25);transform:translateY(-1px)}
.nv-compose:active{transform:scale(.97)}
.nv-compose .ni{font-size:18px;width:22px;text-align:center;flex-shrink:0}

/* ‚ïê‚ïê HAMBURGER BUTTON (mobile only) ‚ïê‚ïê */
.hamburger{
  display:none;
  width:38px;height:38px;border-radius:9px;border:1.5px solid var(--border);
  background:#fff;cursor:pointer;align-items:center;justify-content:center;
  flex-direction:column;gap:5px;flex-shrink:0;transition:all .15s;
}
.hamburger:hover{border-color:var(--purple);background:var(--purple-soft)}
.hamburger span{display:block;width:16px;height:2px;background:var(--t1);border-radius:2px;transition:all .25s}
.hamburger.open span:nth-child(1){transform:translateY(7px) rotate(45deg)}
.hamburger.open span:nth-child(2){opacity:0;transform:scaleX(0)}
.hamburger.open span:nth-child(3){transform:translateY(-7px) rotate(-45deg)}

/* Sidebar overlay (mobile) */
.sidebar-overlay{
  display:none;position:fixed;inset:0;background:rgba(15,23,42,.45);
  z-index:49;backdrop-filter:blur(2px);
}
.sidebar-overlay.show{display:block}

/* ‚ïê‚ïê MOBILE BOTTOM NAV ‚ïê‚ïê */
.bottom-nav{
  display:none;
  position:fixed;bottom:0;left:0;right:0;
  background:#fff;border-top:1.5px solid var(--border);
  padding:6px 0 max(6px, env(safe-area-inset-bottom));
  z-index:48;
  justify-content:space-around;align-items:center;
}
.bn-item{
  display:flex;flex-direction:column;align-items:center;gap:2px;
  padding:5px 12px;border-radius:10px;cursor:pointer;
  font-size:9.5px;font-weight:600;color:var(--t2);transition:all .15s;min-width:56px;
}
.bn-item .bn-icon{font-size:20px;line-height:1}
.bn-item.active{color:var(--purple)}
.bn-item.active .bn-icon{transform:scale(1.1)}
.bn-item:active{transform:scale(.93)}

/* ‚ïê‚ïê RESPONSIVE BREAKPOINTS ‚ïê‚ïê */
@media (max-width: 768px) {
  /* Show hamburger, hide search in topbar */
  .hamburger{display:flex}
  .sw{display:none}

  /* Topbar smaller */
  .topbar{padding:0 14px;height:52px;gap:10px}
  .bc{font-size:14px}

  /* Sidebar becomes overlay drawer */
  .sidebar{
    position:fixed;top:0;left:0;bottom:0;
    z-index:50;
    transform:translateX(-100%);
    transition:transform .28s cubic-bezier(.4,0,.2,1);
    box-shadow:4px 0 24px rgba(15,23,42,.12);
    width:260px;min-width:260px;
  }
  .sidebar.open{transform:translateX(0)}

  /* Main takes full width */
  .main{width:100%}

  /* Stats: 2 per row on mobile */
  .sb{padding:12px 12px 0;gap:8px}
  .sc{min-width:calc(50% - 4px);flex:1 1 calc(50% - 4px);padding:10px 12px;gap:10px}
  .sc-icon{width:34px;height:34px;font-size:16px}
  .sl{font-size:9px}
  .sv{font-size:20px}

  /* Table area */
  .ta{padding:10px 12px 70px;gap:10px}

  /* Filter bar ‚Äî stack vertically */
  .filter-bar{padding:10px 12px;gap:7px}
  .fbar-title{font-size:12px}
  .fsep{display:none}
  .ml-a{display:none}

  /* Chips scroll horizontally */
  .chips-row{
    display:flex;gap:6px;overflow-x:auto;width:100%;
    padding-bottom:2px;scrollbar-width:none;
  }
  .chips-row::-webkit-scrollbar{display:none}
  .chip{flex-shrink:0;font-size:11.5px;padding:5px 11px}

  /* Table: horizontal scroll */
  .tw{border-radius:10px}
  table{font-size:12px}
  thead th{padding:8px 10px;font-size:9px}
  td{padding:9px 10px}

  /* Hide less important columns on mobile */
  .col-ngaydk{display:none}
  .col-goi{display:none}
  .col-ghichu{display:none}
  .col-conlai{display:none}

  /* Avatar smaller */
  .avatar{width:30px;height:30px;font-size:10px}
  .av-name{font-size:12px}
  .av-sub{font-size:10px}

  /* Action buttons bigger touch target */
  .act-btn{width:34px;height:34px;font-size:15px}

  /* Scroll pages */
  .scroll-page{padding:12px 12px 70px;gap:12px}

  /* Sum pills: 2-3 per row */
  .sum-pills{padding:12px;gap:8px;grid-template-columns:repeat(2,1fr)}
  .sum-pill{padding:12px 8px 10px}
  .sum-pill:last-child{grid-column:1/-1}
  .sum-pill .sp-num{font-size:24px}
  .sum-pill .sp-label{font-size:9.5px}
  .sum-pill .sp-sub{display:none}

  /* Alert cards: stack */
  .alert-grid{grid-template-columns:1fr!important}

  /* KPI cards: stack */
  .kpi-row{flex-direction:column!important}

  /* BD grid: stack */
  .bd-grid{grid-template-columns:1fr!important}

  /* Modal full width */
  .modal{width:100%!important;max-width:100%!important;border-radius:20px 20px 0 0!important;position:fixed!important;bottom:0!important;top:auto!important;animation:slideUp .28s cubic-bezier(.4,0,.2,1)!important}
  @keyframes slideUp{from{transform:translateY(100%)}to{transform:none}}
  .mbk{align-items:flex-end!important}
  .modal::before{border-radius:20px 20px 0 0}

  /* Status bar hidden on mobile (covered by bottom nav) */
  .statusbar{display:none}

  /* Show bottom nav */
  .bottom-nav{display:flex}

  /* PWA banner smaller */
  #pwa-banner{font-size:11px;padding:7px 14px;flex-wrap:wrap;gap:7px}
}

@media (max-width: 400px) {
  .sc{min-width:calc(50% - 4px)}
  .sv{font-size:18px}
}

/* ‚ïê‚ïê LOGIN / IDENTITY ‚ïê‚ïê */
.login-overlay{
  position:fixed;inset:0;background:rgba(0,0,0,.55);
  backdrop-filter:blur(10px);z-index:400;
  display:flex;align-items:center;justify-content:center;
}
.login-overlay.hidden{display:none}
.login-box{
  background:#fff;border-radius:20px;padding:36px 32px 28px;
  width:360px;max-width:94vw;
  box-shadow:0 24px 64px rgba(0,0,0,.18);
  animation:su .25s cubic-bezier(.34,1.5,.64,1);
  text-align:center;
}
.login-logo{font-size:40px;margin-bottom:10px}
.login-title{font-size:18px;font-weight:800;color:var(--t0);margin-bottom:4px}
.login-sub{font-size:12px;color:var(--t2);margin-bottom:24px}
.login-name-input{
  width:100%;background:#f8f9fc;border:2px solid var(--border2);
  color:var(--t0);font-family:var(--fb);font-size:14px;font-weight:500;
  padding:10px 14px;border-radius:10px;outline:none;
  transition:all .2s;margin-bottom:12px;text-align:center;
}
.login-name-input:focus{border-color:var(--purple);box-shadow:0 0 0 3px rgba(108,71,255,.12)}
.login-role-row{display:flex;gap:10px;margin-bottom:20px}
.login-role-btn{
  flex:1;padding:10px 8px;border-radius:10px;border:2px solid var(--border2);
  background:#f8f9fc;cursor:pointer;transition:all .15s;
  font-family:var(--fb);font-size:12px;font-weight:600;color:var(--t1);
}
.login-role-btn.selected{border-color:var(--purple);background:rgba(108,71,255,.07);color:var(--purple)}
.login-role-btn .lrb-icon{font-size:22px;display:block;margin-bottom:4px}
.login-enter-btn{
  width:100%;padding:11px;border-radius:10px;border:none;
  background:var(--purple);color:#fff;font-family:var(--fb);
  font-size:13px;font-weight:700;cursor:pointer;transition:all .15s;
  box-shadow:0 4px 14px rgba(108,71,255,.3);
}
.login-enter-btn:hover{background:#7c5cfc}

/* User badge in topbar */
.user-badge{
  display:flex;align-items:center;gap:7px;cursor:pointer;
  background:#f8f9fc;border:1.5px solid var(--border2);
  border-radius:99px;padding:4px 10px 4px 6px;
  transition:all .15s;flex-shrink:0;
}
.user-badge:hover{border-color:var(--purple);background:rgba(108,71,255,.05)}
.user-avatar{
  width:26px;height:26px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-size:12px;font-weight:800;color:#fff;flex-shrink:0;
}
.user-name{font-size:11.5px;font-weight:700;color:var(--t0)}
.user-role{font-size:9.5px;color:var(--t2);letter-spacing:.3px}

/* Role chip */
.role-admin{background:rgba(108,71,255,.1);color:var(--purple);border:1px solid rgba(108,71,255,.2);border-radius:5px;padding:1px 6px;font-size:9.5px;font-weight:700}
.role-user{background:rgba(14,168,104,.1);color:var(--green);border:1px solid rgba(14,168,104,.2);border-radius:5px;padding:1px 6px;font-size:9.5px;font-weight:700}

/* ‚ïê‚ïê ACTIVITY LOG ‚ïê‚ïê */
.log-item{
  display:flex;align-items:flex-start;gap:12px;
  padding:11px 16px;border-bottom:1px solid var(--border);
  transition:background .1s;
}
.log-item:hover{background:#fafbff}
.log-item:last-child{border-bottom:none}
.log-icon-wrap{
  width:34px;height:34px;border-radius:10px;
  display:flex;align-items:center;justify-content:center;
  font-size:15px;flex-shrink:0;margin-top:1px;
}
.log-main{flex:1;min-width:0}
.log-action{font-size:12.5px;font-weight:600;color:var(--t0)}
.log-detail{font-size:11px;color:var(--t2);margin-top:2px;line-height:1.5}
.log-time{font-size:10px;color:var(--t2);flex-shrink:0;text-align:right;line-height:1.6}
.log-who{font-size:10px;font-weight:600;margin-top:2px}
.undo-btn{
  background:none;border:1.5px solid var(--border2);color:var(--t1);
  font-family:var(--fb);font-size:10.5px;font-weight:600;
  padding:3px 9px;border-radius:7px;cursor:pointer;
  transition:all .14s;margin-top:4px;flex-shrink:0;
}
.undo-btn:hover{border-color:var(--purple);color:var(--purple);background:rgba(108,71,255,.06)}
.undo-btn:disabled{opacity:.35;cursor:not-allowed}

/* Log filter row */
.log-filters{
  display:flex;align-items:center;gap:8px;
  padding:10px 16px;border-bottom:1.5px solid var(--border);
  flex-shrink:0;flex-wrap:wrap;background:#fafbff;
}
.log-chip{
  padding:4px 11px;border-radius:99px;
  border:1.5px solid var(--border2);background:#fff;
  font-size:11px;font-weight:600;color:var(--t1);
  cursor:pointer;transition:all .14s;
}
.log-chip.active{background:var(--purple);color:#fff;border-color:var(--purple)}

</style>
</head>
<body>

<!-- Loading Overlay -->
<div class="loading-overlay" id="loading-overlay">
  <div style="width:56px;height:56px;border-radius:16px;background:linear-gradient(135deg,#6c47ff,#9b6fff);display:flex;align-items:center;justify-content:center;font-size:28px;box-shadow:0 8px 28px rgba(108,71,255,.35)">üèãÔ∏è</div>
  <div class="spinner"></div>
  <div style="font-family:var(--fh);font-size:15px;font-weight:700;color:var(--t0)">HUY GYM</div>
  <div style="font-size:12px;color:var(--t2)" id="loading-msg">ƒêang k·∫øt n·ªëi Firebase‚Ä¶</div>
</div>

<div class="app">

<!-- ‚ïê‚ïê SIDEBAR ‚ïê‚ïê -->
<aside class="sidebar">
  <div class="logo">
    <div class="logo-icon">üèãÔ∏è</div>
    <div>
      <div class="logo-name">HUY GYM</div>
      <div class="logo-sub">Qu·∫£n L√Ω H·ªçc Vi√™n</div>
    </div>
  </div>
  <nav class="nav">
    <div class="nav-sec">Menu</div>
    <div class="nv active" id="nav-dashboard" onclick="showPage('dashboard');closeSidebar()"><span class="ni">üìä</span><span>B·∫£ng ƒëi·ªÅu khi·ªÉn</span></div>
    <div class="nv" id="nav-thongke" onclick="showPage('thongke');closeSidebar()"><span class="ni">üìà</span><span>Th·ªëng k√™ / B√°o c√°o</span></div>
    <div class="nv" id="nav-biendog" onclick="showPage('biendog');closeSidebar()"><span class="ni">üîÑ</span><span>Bi·∫øn ƒë·ªông h·ªçc vi√™n</span></div>
    <div class="nav-sec" style="margin-top:4px">H√†nh ƒë·ªông</div>
    <div class="nv-compose" onclick="openAdd();closeSidebar()"><span class="ni">‚úèÔ∏è</span><span>Th√™m h·ªçc vi√™n</span></div>
    <div class="nv" onclick="capNhatTatCa()"><span class="ni">üîÅ</span><span>C·∫≠p nh·∫≠t t·∫•t c·∫£</span></div>
    <div class="nv" onclick="buNgayLe()"><span class="ni">üéâ</span><span>B√π ng√†y ngh·ªâ l·ªÖ</span></div>
    <div class="nav-sec" style="margin-top:4px">Nh·∫≠t k√Ω</div>
    <div class="nv" id="nav-log" onclick="showPage('log');closeSidebar()"><span class="ni">üìã</span><span>L·ªãch s·ª≠ ho·∫°t ƒë·ªông</span></div>
    <div class="nav-sec" style="margin-top:4px">D·ªØ li·ªáu</div>
    <div class="nv" onclick="exportData()"><span class="ni">üíæ</span><span>Xu·∫•t JSON</span></div>
    <div class="nv" onclick="importData()"><span class="ni">üìÇ</span><span>Nh·∫≠p JSON</span></div>
  </nav>
  <div class="sf">
    <div class="clock" id="clock">00:00:00</div>
    <div class="clock-d" id="clock-d"></div>
    <div class="fb-status">
      <div class="fb-dot" id="fb-dot"></div>
      <span id="fb-label">Firebase</span>
    </div>
    <div class="ver">HUY GYM ¬∑ Firebase ¬∑ PWA</div>
  </div>
</aside>

<!-- ‚ïê‚ïê MAIN ‚ïê‚ïê -->
<div class="main">

  <!-- Offline banner -->
  <div id="offline-bar">‚ö° B·∫°n ƒëang offline ‚Äî D·ªØ li·ªáu t·ª´ b·ªô nh·ªõ c·ª•c b·ªô</div>

  <!-- PWA Install Banner -->
  <div id="pwa-banner">
    <span>üì± <b>C√†i ƒë·∫∑t HUY GYM</b> l√™n m√†n h√¨nh ch√≠nh ƒë·ªÉ d√πng nh∆∞ app!</span>
    <button class="pwa-install-btn" id="pwa-install-btn">C√†i ƒë·∫∑t</button>
    <button class="pwa-dismiss-btn" id="pwa-dismiss-btn">‚úï</button>
  </div>

  <!-- Sidebar Overlay -->
  <div class="sidebar-overlay" id="sidebar-overlay" onclick="closeSidebar()"></div>

  <!-- Topbar -->
  <div class="topbar">
    <button class="hamburger" id="hamburger" onclick="toggleSidebar()">
      <span></span><span></span><span></span>
    </button>
    <div class="bc" id="bc">B·∫£ng ƒëi·ªÅu khi·ªÉn <span>/ Danh s√°ch h·ªçc vi√™n</span></div>
    <div class="user-badge" id="user-badge" onclick="doLogout()" title="ƒê·ªïi ng∆∞·ªùi d√πng">
      <div class="user-avatar" id="user-avatar" style="background:var(--purple)">?</div>
      <div>
        <div class="user-name" id="user-name-display">Ch∆∞a ƒëƒÉng nh·∫≠p</div>
        <div class="user-role" id="user-role-display">‚Äî</div>
      </div>
    </div>
    <div class="sw" id="sw-wrap">
      <span class="si">‚åï</span>
      <input type="text" id="search" placeholder="T√¨m t√™n, SƒêT, ghi ch√∫..." oninput="renderTable()"/>
    </div>
  </div>

  <!-- ‚ïê‚ïê PAGE: Dashboard ‚ïê‚ïê -->
  <div class="page active" id="page-dashboard">
    <!-- Stats Row -->
    <div class="sb">
      <div class="sc" style="--c:var(--purple);--ci:var(--purple-soft)">
        <div class="sc-icon">üë•</div>
        <div class="sc-body"><div class="sl">T·ªïng h·ªçc vi√™n</div><div class="sv" id="s-tong">0</div></div>
      </div>
      <div class="sc" style="--c:var(--green);--ci:var(--green-soft)">
        <div class="sc-icon" style="background:var(--green-soft)">üü¢</div>
        <div class="sc-body"><div class="sl">ƒêang ho·∫°t ƒë·ªông</div><div class="sv" id="s-active">0</div></div>
      </div>
      <div class="sc" style="--c:var(--orange);--ci:var(--orange-soft)">
        <div class="sc-icon" style="background:var(--orange-soft)">‚ö†Ô∏è</div>
        <div class="sc-body"><div class="sl">S·∫Øp h·∫øt h·∫°n</div><div class="sv" id="s-warn">0</div></div>
      </div>
      <div class="sc" style="--c:var(--red);--ci:var(--red-soft)">
        <div class="sc-icon" style="background:var(--red-soft)">üî¥</div>
        <div class="sc-body"><div class="sl">ƒê√£ h·∫øt h·∫°n</div><div class="sv" id="s-exp">0</div></div>
      </div>
      <div class="sc" style="--c:var(--gray);--ci:var(--gray-soft)">
        <div class="sc-icon" style="background:var(--gray-soft)">‚è∏Ô∏è</div>
        <div class="sc-body"><div class="sl">T·∫°m d·ª´ng</div><div class="sv" id="s-pause">0</div></div>
      </div>
    </div>

    <!-- Table area -->
    <div class="ta">
      <div class="filter-bar">
        <div class="fbar-title">Danh s√°ch h·ªçc vi√™n</div>
        <div class="fsep"></div>
        <button class="btn bp" onclick="openAdd()">‚ûï Th√™m</button>
        <button class="btn bs" onclick="editSel()">‚úèÔ∏è S·ª≠a</button>
        <button class="btn bd" onclick="delSel()">üóëÔ∏è X√≥a</button>
        <button class="btn bg" onclick="capNhatTatCa()">üîÅ C·∫≠p nh·∫≠t</button>
        <button class="btn bo" onclick="buNgayLe()">üéâ B√π l·ªÖ</button>
        <div class="fsep"></div>
        <div class="chips-row">
          <span class="chip active" id="chip-all"     onclick="setChip('all')">T·∫•t c·∫£</span>
          <span class="chip"        id="chip-active"  onclick="setChip('active')">Ho·∫°t ƒë·ªông</span>
          <span class="chip"        id="chip-warning" onclick="setChip('warning')">S·∫Øp HH</span>
          <span class="chip"        id="chip-expired" onclick="setChip('expired')">H·∫øt h·∫°n</span>
          <span class="chip"        id="chip-paused"  onclick="setChip('paused')">T·∫°m d·ª´ng</span>
        </div>
        <div class="ml-a"><span class="hint-t" id="row-count">0 h·ªçc vi√™n</span></div>
      </div>
      <div class="tw">
        <table>
          <thead><tr>
            <th style="width:46px" onclick="sortBy('id')">ID<span class="sa" data-col="id">‚Üï</span></th>
            <th onclick="sortBy('ten')">H·ªçc Vi√™n<span class="sa" data-col="ten">‚Üï</span></th>
            <th class="col-ngaydk" onclick="sortBy('ngay_bd')">Ng√†y ƒêK<span class="sa" data-col="ngay_bd">‚Üï</span></th>
            <th class="col-goi" onclick="sortBy('so_ngay')" style="text-align:center">G√≥i<span class="sa" data-col="so_ngay">‚Üï</span></th>
            <th onclick="sortBy('ngay_hh')">H·∫øt H·∫°n<span class="sa" data-col="ngay_hh">‚Üï</span></th>
            <th class="col-conlai" onclick="sortBy('con_lai')" style="text-align:center">C√≤n L·∫°i<span class="sa" data-col="con_lai">‚Üï</span></th>
            <th onclick="sortBy('tt')">Tr·∫°ng Th√°i<span class="sa" data-col="tt">‚Üï</span></th>
            <th class="col-ghichu">Ghi Ch√∫</th>
            <th style="text-align:center">Thao T√°c</th>
          </tr></thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê PAGE: Th·ªëng k√™ ‚ïê‚ïê -->
  <div class="page" id="page-thongke">
    <div class="scroll-page" id="tkp"></div>
  </div>

  <!-- ‚ïê‚ïê PAGE: Bi·∫øn ƒë·ªông ‚ïê‚ïê -->
  <div class="page" id="page-biendog">
    <div class="scroll-page" id="bdp"></div>
  </div>


  <!-- ‚ïê‚ïê PAGE: Nh·∫≠t k√Ω ‚ïê‚ïê -->
  <div class="page" id="page-log">
    <div style="display:flex;flex-direction:column;flex:1;min-height:0;overflow:hidden">
      <div class="log-filters" id="log-filters">
        <span style="font-size:12px;font-weight:700;color:var(--t0);margin-right:4px">üóÇ L·ªçc:</span>
        <button class="log-chip active" onclick="setLogFilter('all')">T·∫•t c·∫£</button>
        <button class="log-chip" onclick="setLogFilter('add')">‚ûï Th√™m</button>
        <button class="log-chip" onclick="setLogFilter('edit')">‚úèÔ∏è S·ª≠a</button>
        <button class="log-chip" onclick="setLogFilter('delete')">üóë X√≥a</button>
        <button class="log-chip" onclick="setLogFilter('other')">‚öôÔ∏è Kh√°c</button>
        <div style="margin-left:auto;display:flex;gap:6px;align-items:center">
          <span id="log-count" style="font-size:11px;color:var(--t2)"></span>
          <button class="btn bs" style="font-size:11px;padding:4px 10px" onclick="clearAllLogs()" id="clear-log-btn">üóë X√≥a t·∫•t c·∫£ log</button>
        </div>
      </div>
      <div style="flex:1;overflow-y:auto;min-height:0" id="log-list"></div>
    </div>
  </div>

  <!-- Status bar -->
  <div class="statusbar">
    <div class="sd"></div>
    <div class="sm" id="smsg">ƒêang k·∫øt n·ªëi‚Ä¶</div>
    <div id="stime" style="font-size:10.5px;color:var(--t2)"></div>
  </div>
</div>
</div>

<!-- ‚ïê‚ïê MODAL: Th√™m/S·ª≠a ‚ïê‚ïê -->
<div class="mbk" id="mf">
  <div class="modal">
    <div class="mh"><div class="mt" id="mft">Th√™m H·ªçc Vi√™n</div><button class="mc" onclick="closeForm()">‚úï</button></div>
    <div class="mb2">
      <div class="fg">
        <div class="fgi full"><label class="fl">H·ªç T√™n *</label><input class="fi" id="f-ten" placeholder="Nguy·ªÖn VƒÉn A"/></div>
        <div class="fgi"><label class="fl">S·ªë ƒêi·ªán Tho·∫°i</label><input class="fi" id="f-sdt" placeholder="0901234567"/></div>
        <div class="fgi"><label class="fl">Ng√†y ƒêƒÉng K√Ω *</label><input class="fi" id="f-ngay-bd" type="date"/></div>
        <div class="fgi"><label class="fl">G√≥i T·∫≠p *</label>
          <select class="fs" id="f-so-ngay">
            <option value="">-- Ch·ªçn g√≥i --</option>
            <option value="1">1 ng√†y</option>
            <option value="30">30 ng√†y (1 th√°ng)</option>
            <option value="60">60 ng√†y (2 th√°ng)</option>
            <option value="90">90 ng√†y (3 th√°ng)</option>
            <option value="120">120 ng√†y (4 th√°ng)</option>
            <option value="150">150 ng√†y (5 th√°ng)</option>
            <option value="180">180 ng√†y (6 th√°ng)</option>
            <option value="365">365 ng√†y (1 nƒÉm)</option>
          </select>
        </div>
        <div class="fgi"><label class="fl">Ng√†y B√π</label><input class="fi" id="f-ngay-bu" type="number" min="0" placeholder="0"/></div>
        <div class="fgi"><label class="fl">Gi√° Thu (VNƒê)</label><input class="fi" id="f-gia" type="number" min="0" placeholder="0" step="10000"/></div>
        <div class="fgi"><label class="fl">Tr·∫°ng Th√°i</label>
          <select class="fs" id="f-tt">
            <option value="active">üü¢ Ho·∫°t ƒê·ªông</option>
            <option value="warning">‚ö†Ô∏è S·∫Øp H·∫øt H·∫°n</option>
            <option value="expired">üî¥ H·∫øt H·∫°n</option>
            <option value="paused">‚è∏Ô∏è T·∫°m D·ª´ng</option>
          </select>
        </div>
        <div class="fgi full"><label class="fl">Ghi Ch√∫</label><input class="fi" id="f-ghi-chu" placeholder="Ghi ch√∫ th√™m..."/></div>
        <div class="fgi full"><div id="f-ngay-dk-info" style="font-size:11px;color:var(--purple);padding:7px 11px;background:var(--purple-soft);border-radius:8px;display:none;border:1px solid var(--purple-mid)"></div></div>
      </div>
    </div>
    <div class="mf2">
      <button class="btn bs" onclick="closeForm()">H·ªßy b·ªè</button>
      <button class="btn bp" onclick="saveForm()">üíæ L∆∞u</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê MODAL: X√°c nh·∫≠n x√≥a ‚ïê‚ïê -->
<div class="mbk cm" id="mc">
  <div class="modal">
    <div class="cb">
      <div style="width:58px;height:58px;border-radius:50%;background:var(--red-soft);border:2px solid rgba(239,68,68,.2);display:inline-flex;align-items:center;justify-content:center;font-size:28px;margin-bottom:12px">üóëÔ∏è</div>
      <div style="font-family:var(--fh);font-size:15px;font-weight:700;color:var(--t0);margin-bottom:6px">X√°c nh·∫≠n x√≥a</div>
      <div style="color:var(--t1);font-size:13px;line-height:1.6">B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a h·ªçc vi√™n</div>
      <div style="color:var(--t0);font-weight:700;font-size:14px;margin-top:5px" id="cnm"></div>
      <div style="color:var(--t2);font-size:11.5px;margin-top:6px">H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.</div>
    </div>
    <div class="mf2" style="justify-content:center">
      <button class="btn bs" onclick="closeConfirm()">H·ªßy</button>
      <button class="btn bd" onclick="confirmDelete()">X√°c nh·∫≠n x√≥a</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê MODAL: Alert ‚ïê‚ïê -->
<div class="mbk am-modal" id="am" onclick="if(event.target===this)closeAM()">
  <div class="modal" style="width:520px">
    <div class="mh" style="position:relative">
      <div id="am-bar" style="position:absolute;top:0;left:0;right:0;height:3px;z-index:2"></div>
      <span id="am-icon" style="font-size:18px"></span>
      <span class="mt" id="am-title"></span>
      <span id="am-cnt" class="badge" style="flex-shrink:0"></span>
      <button class="mc" onclick="closeAM()">‚úï</button>
    </div>
    <div id="am-body" style="overflow-y:auto;flex:1;min-height:0"></div>
  </div>
</div>

<input type="file" id="ii" accept=".json" style="display:none" onchange="handleImport(event)"/>

<!-- ‚ïê‚ïê FIREBASE SDK ‚ïê‚ïê -->
<script type="module">
'use strict';
import { initializeApp }  from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
import { getAnalytics }   from "https://www.gstatic.com/firebasejs/11.0.0/firebase-analytics.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-database.js";

const firebaseConfig = {
  apiKey:            "AIzaSyD5lpI3K6c0JtyfR85u8EFPyEKDJKxdWQ0",
  authDomain:        "huygym-16f43.firebaseapp.com",
  databaseURL:       "https://huygym-16f43-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId:         "huygym-16f43",
  storageBucket:     "huygym-16f43.firebasestorage.app",
  messagingSenderId: "1054418294164",
  appId:             "1:1054418294164:web:255994f8c27ac036cdeb81",
  measurementId:     "G-MVD1820M08"
};
const fbApp = initializeApp(firebaseConfig);
const fbDB  = getDatabase(fbApp);
const dbRef = ref(fbDB,'gym_members');
try{getAnalytics(fbApp);}catch(e){}

// ‚îÄ‚îÄ Constants & State ‚îÄ‚îÄ
const WD=7, SK='gym_pro_v5';
let recs=[],eId=null,dId=null;
let sCol='id',sAsc=true,selId=null;
let tkWarn=[],tkExp=[];
let _fbReady=false;
let activeChip='all';

// ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ
function normTT(tt){
  if(!tt) return 'active';
  if(['active','warning','expired','paused'].includes(tt)) return tt;
  const s=String(tt).toLowerCase();
  if(s.includes('tam')||s.includes('d·ª´ng')||s.includes('dung')) return 'paused';
  if(s.includes('het')||s.includes('h·∫øt')||s.includes('h·∫°n')) return 'expired';
  if(s.includes('sap')||s.includes('s·∫Øp')) return 'warning';
  return 'active';
}
function today(){return new Date(new Date().setHours(0,0,0,0));}
function dd(a,b){return Math.round((a-b)/86400000);}
function getTag(r){
  if(r.tt==='paused') return 'paused';
  if(r.con_lai<0) return 'expired';
  if(r.con_lai<=WD) return 'warning';
  return 'active';
}
function recalc(r){
  if(!(r.ngay_bd instanceof Date)||isNaN(r.ngay_bd)||!r.so_ngay) return;
  r.ngay_hh=new Date(r.ngay_bd);
  r.ngay_hh.setDate(r.ngay_hh.getDate()+r.so_ngay+(r.ngay_bu||0));
  r.con_lai=dd(r.ngay_hh,today());
  if(r.tt!=='paused'){
    if(r.con_lai<0) r.tt='expired';
    else if(r.con_lai<=WD) r.tt='warning';
    else r.tt='active';
  }
}
function recalcAll(){recs.forEach(r=>{r.tt=normTT(r.tt);recalc(r);});}
function fmtD(d){if(!(d instanceof Date)||isNaN(d)) return '‚Äî';return d.toLocaleDateString('vi-VN',{day:'2-digit',month:'2-digit',year:'numeric'});}
function fmtMK(d){return 'T'+String(d.getMonth()+1).padStart(2,'0')+'-'+d.getFullYear();}
function esc(s){return String(s||'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[c]);}
function getInitials(n){return(n||'?').split(' ').map(w=>w[0]).join('').toUpperCase().slice(0,2);}

function parseRec(r){
  if(typeof r.ngay_bd==='string') r.ngay_bd=new Date(r.ngay_bd);
  if(typeof r.ngay_hh==='string') r.ngay_hh=new Date(r.ngay_hh);
  if(typeof r.ngay_dk==='string') r.ngay_dk=new Date(r.ngay_dk);
  if(!r.ngay_dk||!(r.ngay_dk instanceof Date)||isNaN(r.ngay_dk))
    r.ngay_dk=r.ngay_bd instanceof Date?new Date(r.ngay_bd):null;
  r.tt=normTT(r.tt);r.so_ngay=parseInt(r.so_ngay)||0;r.ngay_bu=parseInt(r.ngay_bu)||0;r.gia=parseFloat(r.gia)||0;
  return r;
}
function serializeRecs(arr){
  return arr.map(r=>({
    id:r.id,ten:r.ten||'',sdt:r.sdt||'',
    ngay_dk:r.ngay_dk instanceof Date?r.ngay_dk.toISOString():(r.ngay_dk||''),
    ngay_bd:r.ngay_bd instanceof Date?r.ngay_bd.toISOString():(r.ngay_bd||''),
    so_ngay:r.so_ngay||0,
    ngay_hh:r.ngay_hh instanceof Date?r.ngay_hh.toISOString():(r.ngay_hh||''),
    con_lai:r.con_lai||0,ngay_bu:r.ngay_bu||0,tt:r.tt||'active',ghi_chu:r.ghi_chu||'',gia:r.gia||0,
  }));
}

// ‚îÄ‚îÄ Firebase Status ‚îÄ‚îÄ
function setFbStatus(s,l){
  const d=document.getElementById('fb-dot'),lb=document.getElementById('fb-label');
  if(!d||!lb) return;
  d.className='fb-dot '+(s||'');lb.textContent=l||'Firebase';
}

// ‚îÄ‚îÄ Firebase Sync ‚îÄ‚îÄ

function hideLoading(){
  const ov = document.getElementById('loading-overlay');
  if(ov) ov.classList.add('hidden');
  initIdentity();
}

function initFirebaseSync(){
  setFbStatus('syncing','ƒêang k·∫øt n·ªëi‚Ä¶');
  document.getElementById('loading-msg').textContent='ƒêang t·∫£i d·ªØ li·ªáu t·ª´ Firebase‚Ä¶';

  // Timeout fallback: n·∫øu 6 gi√¢y ch∆∞a xong ‚Üí b·ªè qua, d√πng local
  const fbTimeout = setTimeout(()=>{
    if(!_fbReady){
      console.warn('Firebase timeout ‚Äî d√πng d·ªØ li·ªáu c·ª•c b·ªô');
      _fbReady = true;
      loadLocalFallback();
      hideLoading();
      setFbStatus('error','Timeout');
      toast('Firebase ch·∫≠m ‚Äî ƒëang d√πng d·ªØ li·ªáu c·ª•c b·ªô','warn');
    }
  }, 6000);
  onValue(dbRef,(snapshot)=>{
    const raw=snapshot.val();
    if(raw!==null&&raw!==undefined){
      let arr=Array.isArray(raw)?raw:Object.values(raw);
      recs=arr.filter(Boolean).map(r=>parseRec({...r}));
    } else if(!_fbReady){
      try{const loc=localStorage.getItem(SK);if(loc){recs=JSON.parse(loc);recs.forEach(r=>parseRec(r));saveData();toast('ƒê√£ di chuy·ªÉn localStorage ‚Üí Firebase ‚òÅÔ∏è','ok');}else recs=[];}catch(e){recs=[];}
    } else{recs=[];}
    recalcAll();renderTable();
    clearTimeout(fbTimeout);if(!_fbReady){_fbReady=true;hideLoading();toast('K·∫øt n·ªëi Firebase th√†nh c√¥ng! ‚òÅÔ∏è','ok');}
    setFbStatus('online','ƒê·ªìng b·ªô ‚úì');
    setSt('Firebase ¬∑ '+recs.length+' h·ªçc vi√™n ¬∑ '+new Date().toLocaleTimeString('vi-VN'));
    try{localStorage.setItem(SK,JSON.stringify(serializeRecs(recs)));}catch(e){}
  },(error)=>{
    console.error('Firebase error:',error);
    setFbStatus('error','L·ªói k·∫øt n·ªëi');
    if(!_fbReady){_fbReady=true;loadLocalFallback();clearTimeout(fbTimeout);hideLoading();toast('Kh√¥ng k·∫øt n·ªëi ƒë∆∞·ª£c Firebase. D√πng d·ªØ li·ªáu c·ª•c b·ªô.','warn');}
  });
}

function loadLocalFallback(){
  try{const raw=localStorage.getItem(SK);if(raw){recs=JSON.parse(raw);recs.forEach(r=>parseRec(r));}else recs=[];}catch(e){recs=[];}
  recalcAll();renderTable();
  setSt('Ch·∫ø ƒë·ªô c·ª•c b·ªô (offline) ¬∑ '+recs.length+' h·ªçc vi√™n');
}

function saveData(){
  set(dbRef,serializeRecs(recs)).catch(e=>{console.error(e);toast('L·ªói l∆∞u Firebase!','warn');});
  try{localStorage.setItem(SK,JSON.stringify(serializeRecs(recs)));}catch(e){}
}

// ‚îÄ‚îÄ Navigation ‚îÄ‚îÄ
function showPage(p){
  document.querySelectorAll('.page').forEach(x=>x.classList.remove('active'));
  document.querySelectorAll('.nv').forEach(x=>x.classList.remove('active'));
  document.getElementById('page-'+p).classList.add('active');
  const ni=document.getElementById('nav-'+p);if(ni) ni.classList.add('active');
  const bcs={
    dashboard:'B·∫£ng ƒëi·ªÅu khi·ªÉn <span>/ Danh s√°ch h·ªçc vi√™n</span>',
    thongke:'Th·ªëng k√™ <span>/ B√°o c√°o t·ªïng h·ª£p</span>',
    biendog:'Bi·∫øn ƒë·ªông <span>/ So s√°nh th√°ng</span>',
    log:'üìã Nh·∫≠t k√Ω <span>/ L·ªãch s·ª≠ ho·∫°t ƒë·ªông</span>',
  };
  document.getElementById('bc').innerHTML=bcs[p]||'';
  document.getElementById('sw-wrap').style.visibility=p==='dashboard'?'':'hidden';
  const picker=document.getElementById('bd-picker');
  if(picker) picker.classList.toggle('show', p==='biendog');
  if(p==='thongke') renderTK();
  if(p==='biendog'){bdPopulateMonthSel();renderBD();}
  if(p==='log') renderLog();
}

// ‚îÄ‚îÄ Chip Filter ‚îÄ‚îÄ
function setChip(v){
  activeChip=v;
  document.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
  const el=document.getElementById('chip-'+v);if(el) el.classList.add('active');
  renderTable();
}

// ‚îÄ‚îÄ Table ‚îÄ‚îÄ
const TL={active:'Ho·∫°t ƒê·ªông',warning:'S·∫Øp HH',expired:'H·∫øt H·∫°n',paused:'T·∫°m D·ª´ng'};
const TB={active:'ba',warning:'bw',expired:'be',paused:'bp2'};

function getFlt(){
  const q=document.getElementById('search').value.toLowerCase().trim();
  let list=[...recs];
  if(activeChip!=='all') list=list.filter(r=>getTag(r)===activeChip);
  if(q) list=list.filter(r=>r.ten.toLowerCase().includes(q)||(r.sdt||'').includes(q)||(r.ghi_chu||'').toLowerCase().includes(q));
  return list;
}

function renderTable(){
  const rows=getFlt();
  rows.sort((a,b)=>{
    let va=a[sCol],vb=b[sCol];
    if(va instanceof Date) va=va.getTime();if(vb instanceof Date) vb=vb.getTime();
    if(va==null) return 1;if(vb==null) return -1;
    if(typeof va==='string') va=va.toLowerCase();if(typeof vb==='string') vb=vb.toLowerCase();
    return sAsc?(va>vb?1:va<vb?-1:0):(va<vb?1:va>vb?-1:0);
  });
  const cnt={active:0,warning:0,expired:0,paused:0};
  recs.forEach(r=>cnt[getTag(r)]++);
  [['s-tong',recs.length],['s-active',cnt.active],['s-warn',cnt.warning],['s-exp',cnt.expired],['s-pause',cnt.paused]].forEach(([id,v])=>setS(id,v));
  const rc=document.getElementById('row-count');if(rc) rc.textContent=rows.length+' h·ªçc vi√™n';

  const tb=document.getElementById('tbody');
  if(!rows.length){
    tb.innerHTML=`<tr><td colspan="9"><div class="empty-st"><div class="ei">üèãÔ∏è</div><div style="font-weight:600;font-size:14px">Ch∆∞a c√≥ h·ªçc vi√™n n√†o</div><div style="font-size:12px;color:var(--t3)">Nh·∫•n "Th√™m" ƒë·ªÉ b·∫Øt ƒë·∫ßu</div></div></td></tr>`;
    return;
  }
  tb.innerHTML=rows.map(r=>{
    const tag=getTag(r);const cl=r.con_lai;
    const clC=cl<0?'rc':cl<=WD?'oc':'nc';
    const init=getInitials(r.ten);const sel=r.id===selId;
    return `<tr class="${sel?'sel-row':''}" onclick="selRow(${r.id})" ondblclick="openEdit(${r.id})" data-id="${r.id}">
      <td style="color:var(--t2);font-size:11.5px;font-weight:600">#${r.id}</td>
      <td><div class="av-cell">
        <div class="avatar">${init}</div>
        <div><div class="av-name">${esc(r.ten)}</div><div class="av-sub">${esc(r.sdt||'‚Äî')}</div></div>
      </div></td>
      <td style="font-size:12.5px">${fmtD(r.ngay_bd)}</td>
      <td class="num" style="color:var(--t1)">${r.so_ngay}ng</td>
      <td style="font-size:12.5px">${fmtD(r.ngay_hh)}</td>
      <td class="num ${clC}">${cl}</td>
      <td><span class="badge ${TB[tag]}">${TL[tag]}</span></td>
      <td style="color:var(--t2);font-size:12px;max-width:120px;overflow:hidden;text-overflow:ellipsis" title="${esc(r.ghi_chu||'')}">${esc(r.ghi_chu||'‚Äî')}</td>
      <td><div class="act-cell">
        <button class="act-btn" onclick="event.stopPropagation();openEdit(${r.id})" title="S·ª≠a">‚úèÔ∏è</button>
        <button class="act-btn del" onclick="event.stopPropagation();delById(${r.id})" title="X√≥a">üóëÔ∏è</button>
      </div></td>
    </tr>`;
  }).join('');
}

function setS(id,val){const el=document.getElementById(id);if(!el) return;if(el.textContent!=val){el.textContent=val;el.classList.remove('cu');void el.offsetWidth;el.classList.add('cu');}}

function sortBy(col){
  if(sCol===col) sAsc=!sAsc;else{sCol=col;sAsc=true;}
  document.querySelectorAll('thead th').forEach(th=>th.classList.remove('sorted'));
  document.querySelectorAll('.sa').forEach(a=>{if(a.dataset.col===col){a.textContent=sAsc?'‚Üë':'‚Üì';a.closest('th').classList.add('sorted');}else a.textContent='‚Üï';});
  renderTable();
}

function selRow(id){
  selId=(selId===id)?null:id;
  document.querySelectorAll('tbody tr').forEach(tr=>{const s=parseInt(tr.dataset.id)===selId;tr.classList.toggle('sel-row',s);});
}

document.addEventListener('keydown',e=>{
  if(e.key==='Delete'&&selId!=null&&!document.getElementById('mf').classList.contains('show')) delSel();
  if(e.key==='Escape'){closeForm();closeConfirm();closeAM();}
});

// ‚îÄ‚îÄ CRUD ‚îÄ‚îÄ
function openAdd(){
  eId=null;document.getElementById('mft').textContent='Th√™m H·ªçc Vi√™n M·ªõi';
  const dkEl=document.getElementById('f-ngay-dk-info');if(dkEl){dkEl.textContent='';dkEl.style.display='none';}
  ['f-ten','f-sdt','f-ghi-chu'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('f-ngay-bd').value=new Date().toISOString().slice(0,10);
  document.getElementById('f-so-ngay').value='';document.getElementById('f-ngay-bu').value='0';
  document.getElementById('f-tt').value='active';document.getElementById('f-gia').value='';
  document.getElementById('mf').classList.add('show');setTimeout(()=>document.getElementById('f-ten').focus(),180);
}
function openEdit(id){
  const r=recs.find(x=>x.id===id);if(!r) return;
  eId=id;document.getElementById('mft').textContent='Ch·ªânh S·ª≠a: '+r.ten;
  document.getElementById('f-ten').value=r.ten||'';document.getElementById('f-sdt').value=r.sdt||'';
  document.getElementById('f-ngay-bd').value=r.ngay_bd instanceof Date?r.ngay_bd.toISOString().slice(0,10):'';
  document.getElementById('f-so-ngay').value=r.so_ngay||'';document.getElementById('f-ngay-bu').value=r.ngay_bu||0;
  document.getElementById('f-gia').value=r.gia||'';document.getElementById('f-tt').value=r.tt||'active';
  document.getElementById('f-ghi-chu').value=r.ghi_chu||'';
  const dkEl=document.getElementById('f-ngay-dk-info');
  if(dkEl&&r.ngay_dk){dkEl.textContent='üìÖ Ng√†y ƒëƒÉng k√Ω ƒë·∫ßu ti√™n: '+fmtD(r.ngay_dk);dkEl.style.display='block';}
  document.getElementById('mf').classList.add('show');setTimeout(()=>document.getElementById('f-ten').focus(),180);
}
function editSel(){if(!selId){toast('Ch·ªçn h·ªçc vi√™n c·∫ßn s·ª≠a!','warn');return;}openEdit(selId);}
function closeForm(){document.getElementById('mf').classList.remove('show');}
function saveForm(){
  const ten=document.getElementById('f-ten').value.trim();if(!ten){toast('Vui l√≤ng nh·∫≠p H·ªç T√™n!','err');return;}
  const bdStr=document.getElementById('f-ngay-bd').value;if(!bdStr){toast('Vui l√≤ng ch·ªçn Ng√†y ƒêƒÉng K√Ω!','err');return;}
  const snStr=document.getElementById('f-so-ngay').value;if(!snStr){toast('Vui l√≤ng ch·ªçn G√≥i T·∫≠p!','err');return;}
  const bd=new Date(bdStr),sn=parseInt(snStr),nb=parseInt(document.getElementById('f-ngay-bu').value)||0;
  const gc=document.getElementById('f-ghi-chu').value.trim(),gia=parseFloat(document.getElementById('f-gia').value)||0;
  let tt=document.getElementById('f-tt').value;
  const hh=new Date(bd);hh.setDate(hh.getDate()+sn+nb);
  const cl=dd(hh,today());
  if(tt!=='paused'){if(cl<0) tt='expired';else if(cl<=WD) tt='warning';else tt='active';}
  const data={ten,sdt:document.getElementById('f-sdt').value.trim(),ngay_bd:bd,so_ngay:sn,ngay_hh:hh,con_lai:cl,ngay_bu:nb,tt,ghi_chu:gc,gia};
  if(eId!==null){
    const i=recs.findIndex(r=>r.id===eId);
    if(i>=0){
      const before={...recs[i], ngay_bd:recs[i].ngay_bd instanceof Date?recs[i].ngay_bd.toISOString():recs[i].ngay_bd, ngay_hh:recs[i].ngay_hh instanceof Date?recs[i].ngay_hh.toISOString():recs[i].ngay_hh, ngay_dk:recs[i].ngay_dk instanceof Date?recs[i].ngay_dk.toISOString():recs[i].ngay_dk};
      const eDk=recs[i].ngay_dk; recs[i]={...recs[i],...data}; if(eDk) recs[i].ngay_dk=eDk;
      const after={...recs[i], ngay_bd:recs[i].ngay_bd instanceof Date?recs[i].ngay_bd.toISOString():recs[i].ngay_bd, ngay_hh:recs[i].ngay_hh instanceof Date?recs[i].ngay_hh.toISOString():recs[i].ngay_hh};
      // Compute changes
      const changes={};
      const fields={ten:'T√™n',sdt:'SƒêT',so_ngay:'G√≥i',ngay_bu:'Ng√†y b√π',tt:'T.th√°i',ghi_chu:'Ghi ch√∫',gia:'Gi√°'};
      Object.keys(fields).forEach(k=>{ if(String(before[k]||'')!==String(after[k]||'')) changes[fields[k]]=[before[k]||'',after[k]||'']; });
      logAct('edit',{before,after,changes,ten});
    }
    toast('ƒê√£ c·∫≠p nh·∫≠t: '+ten,'ok');
  }else{
    const nid=recs.length?Math.max(...recs.map(r=>r.id))+1:1;
    recs.push({id:nid,...data,ngay_dk:bd});
    const newRec=recs[recs.length-1];
    logAct('add',{...serializeRecs([newRec])[0], id:nid});
    toast('ƒê√£ th√™m: '+ten,'ok');
  }
  saveData();renderTable();closeForm();setSt('ƒê√£ l∆∞u: '+ten);
}
function delById(id){selId=id;delSel();}
function delSel(){
  if(!selId){toast('Ch·ªçn h·ªçc vi√™n c·∫ßn x√≥a!','warn');return;}
  dId=selId;const r=recs.find(x=>x.id===dId);
  document.getElementById('cnm').textContent=r?r.ten:'';
  document.getElementById('mc').classList.add('show');
}
function closeConfirm(){document.getElementById('mc').classList.remove('show');dId=null;}
function confirmDelete(){
  if(!dId) return;
  const r=recs.find(x=>x.id===dId);
  if(r){
    const snap={...r, ngay_bd:r.ngay_bd instanceof Date?r.ngay_bd.toISOString():r.ngay_bd, ngay_hh:r.ngay_hh instanceof Date?r.ngay_hh.toISOString():r.ngay_hh, ngay_dk:r.ngay_dk instanceof Date?r.ngay_dk.toISOString():r.ngay_dk};
    logAct('delete', snap);
  }
  recs=recs.filter(x=>x.id!==dId);recs.forEach((r,i)=>r.id=i+1);
  selId=null;dId=null;
  saveData();renderTable();closeConfirm();toast('ƒê√£ x√≥a: '+(r?r.ten:''),'warn');
}

// ‚îÄ‚îÄ Actions ‚îÄ‚îÄ
function capNhatTatCa(){recalcAll();saveData();renderTable();logAct('update_all',{count:recs.length});toast('ƒê√£ c·∫≠p nh·∫≠t '+recs.length+' h·ªçc vi√™n','ok');setSt('C·∫≠p nh·∫≠t xong '+recs.length+' h·ªçc vi√™n');}
function buNgayLe(){
  const n=parseInt(prompt('S·ªë ng√†y b√π cho Ho·∫°t ƒê·ªông + S·∫Øp H·∫øt H·∫°n:','1'));if(!n||n<1) return;
  let cnt=0;recs.forEach(r=>{if(r.tt==='active'||r.tt==='warning'){r.ngay_bu=(r.ngay_bu||0)+n;recalc(r);cnt++;}});
  saveData();renderTable();logAct('holiday',{days:n,count:cnt});toast('ƒê√£ b√π '+n+' ng√†y cho '+cnt+' h·ªçc vi√™n','ok');
}
function exportData(){
  const j=JSON.stringify(serializeRecs(recs),null,2);const b=new Blob([j],{type:'application/json'});
  const u=URL.createObjectURL(b);const a=document.createElement('a');
  a.href=u;a.download='gym_data_'+new Date().toISOString().slice(0,10)+'.json';a.click();URL.revokeObjectURL(u);
  toast('ƒê√£ xu·∫•t file JSON!','ok');
}
function importData(){document.getElementById('ii').click();}
function handleImport(e){
  const file=e.target.files[0];if(!file) return;
  const reader=new FileReader();
  reader.onload=ev=>{
    try{let d=JSON.parse(ev.target.result);if(!Array.isArray(d)&&d.records) d=d.records;if(!Array.isArray(d)) throw 0;
      recs=d.map(r=>parseRec({...r}));recalcAll();saveData();renderTable();logAct('import',{count:recs.length});toast('ƒê√£ nh·∫≠p '+recs.length+' h·ªçc vi√™n ‚Üí Firebase ‚òÅÔ∏è','ok');
    }catch{toast('File JSON kh√¥ng h·ª£p l·ªá!','err');}
  };
  reader.readAsText(file);e.target.value='';
}

// ‚îÄ‚îÄ TH·ªêNG K√ä ‚îÄ‚îÄ
function renderTK(){
  const now=new Date();
  const ts=now.toLocaleDateString('vi-VN',{day:'2-digit',month:'2-digit',year:'numeric'})+' '+now.toLocaleTimeString('vi-VN',{hour:'2-digit',minute:'2-digit'});
  const mmap={};
  recs.forEach(r=>{
    if(!(r.ngay_hh instanceof Date)||isNaN(r.ngay_hh)) return;
    const mk=fmtMK(r.ngay_hh),key=r.ngay_hh.getFullYear()*100+r.ngay_hh.getMonth();
    if(!mmap[mk]) mmap[mk]={mk,key,total:0,active:0,warning:0,expired:0,paused:0,rev:0};
    mmap[mk].total++;mmap[mk][getTag(r)]++;mmap[mk].rev+=r.gia||0;
  });
  const months=Object.values(mmap).sort((a,b)=>a.key-b.key);
  const tot={total:0,active:0,warning:0,expired:0,paused:0,rev:0};
  months.forEach(m=>{tot.total+=m.total;tot.active+=m.active;tot.warning+=m.warning;tot.expired+=m.expired;tot.paused+=m.paused;tot.rev+=m.rev;});
  tkWarn=recs.filter(r=>getTag(r)==='warning').sort((a,b)=>a.con_lai-b.con_lai);
  tkExp=recs.filter(r=>getTag(r)==='expired').sort((a,b)=>a.con_lai-b.con_lai);
  const revMonths=Object.values(mmap).filter(m=>m.rev>0).sort((a,b)=>b.key-a.key);
  const maxRev=revMonths.length?Math.max(...revMonths.map(m=>m.rev)):1;

  let h='';
  // ‚îÄ‚îÄ Header card with full labeled pills ‚îÄ‚îÄ
  h+=`<div class="s-card">
    <div class="s-card-hdr">
      <div class="s-card-title">üìã T·ªïng H·ª£p H·ªçc Vi√™n Gym</div>
      <div style="font-size:11px;color:var(--t2)">C·∫≠p nh·∫≠t: ${ts}</div>
    </div>
    <div class="sum-pills">
      <div class="sum-pill" style="background:rgba(108,71,255,.07);border-color:rgba(108,71,255,.2);color:var(--purple)">
        <div class="sp-num">${recs.length}</div>
        <div class="sp-label">T·ªïng h·ªçc vi√™n</div>
        <div class="sp-sub">T·∫•t c·∫£ tr·∫°ng th√°i</div>
      </div>
      <div class="sum-pill" style="background:var(--green-soft);border-color:rgba(14,168,104,.2);color:var(--green)">
        <div class="sp-num">${tot.active}</div>
        <div class="sp-label">ƒêang ho·∫°t ƒë·ªông</div>
        <div class="sp-sub">&gt; ${WD} ng√†y c√≤n l·∫°i</div>
      </div>
      <div class="sum-pill" style="background:var(--orange-soft);border-color:rgba(245,158,11,.2);color:var(--orange)">
        <div class="sp-num">${tot.warning}</div>
        <div class="sp-label">S·∫Øp h·∫øt h·∫°n</div>
        <div class="sp-sub">‚â§ ${WD} ng√†y c√≤n l·∫°i</div>
      </div>
      <div class="sum-pill" style="background:var(--red-soft);border-color:rgba(239,68,68,.2);color:var(--red)">
        <div class="sp-num">${tot.expired}</div>
        <div class="sp-label">ƒê√£ h·∫øt h·∫°n</div>
        <div class="sp-sub">C·∫ßn g·ªçi gia h·∫°n</div>
      </div>
      <div class="sum-pill" style="background:var(--gray-soft);border-color:rgba(100,116,139,.2);color:var(--gray)">
        <div class="sp-num">${tot.paused}</div>
        <div class="sp-label">T·∫°m d·ª´ng</div>
        <div class="sp-sub">ƒêang ngh·ªâ t·∫≠p</div>
      </div>
    </div>
  </div>`;

  // Alert cards
  h+=`<div class="alert-grid" style="display:grid;grid-template-columns:1fr 1fr;gap:12px">`;
  h+=mkAlertCard('warn',tkWarn,'‚ö†Ô∏è','S·∫Øp h·∫øt h·∫°n (‚â§'+WD+' ng√†y)','var(--orange)','rgba(245,158,11,.3)','var(--orange-soft)');
  h+=mkAlertCard('exp',tkExp,'üî¥','ƒê√£ h·∫øt h·∫°n ‚Äî C·∫ßn g·ªçi gia h·∫°n','var(--red)','rgba(239,68,68,.3)','var(--red-soft)');
  h+=`</div>`;

  // Monthly table
  h+=`<div class="s-card"><div class="s-card-hdr">
    <div class="s-card-title">üìä Th·ªëng K√™ Theo Th√°ng</div>
    <span class="s-card-badge">${months.length} th√°ng</span>
  </div><div style="overflow-x:auto">
  <table class="tkt"><thead><tr>
    <th>Th√°ng</th><th>T·ªïng</th><th>Ho·∫°t ƒê·ªông</th><th>S·∫Øp HH</th><th>H·∫øt H·∫°n</th><th>T·∫°m D·ª´ng</th><th>Doanh Thu</th>
  </tr></thead><tbody>`;
  if(!months.length){h+='<tr><td colspan="7" style="text-align:center;padding:20px;color:var(--t2)">Ch∆∞a c√≥ d·ªØ li·ªáu</td></tr>';}
  else{
    months.forEach(m=>{h+=`<tr><td style="font-weight:600;color:var(--t0)">${m.mk}</td><td class="nt">${m.total}</td><td class="na">${m.active||'‚Äì'}</td><td class="nw">${m.warning||'‚Äì'}</td><td class="ne">${m.expired||'‚Äì'}</td><td class="np">${m.paused||'‚Äì'}</td><td style="color:var(--purple);font-weight:500">${m.rev?m.rev.toLocaleString('vi-VN')+'ƒë':'‚Äì'}</td></tr>`;});
    h+=`<tr class="tr"><td>T·ªîNG C·ªòNG</td><td class="nt">${tot.total}</td><td class="na">${tot.active}</td><td class="nw">${tot.warning}</td><td class="ne">${tot.expired}</td><td class="np">${tot.paused}</td><td style="color:var(--purple)">${tot.rev?tot.rev.toLocaleString('vi-VN')+'ƒë':'‚Äì'}</td></tr>`;
  }
  h+=`</tbody></table></div></div>`;

  // Revenue chart
  h+=`<div class="s-card"><div class="s-card-hdr"><div class="s-card-title">üìâ Doanh Thu Theo Th√°ng</div><span class="s-card-badge">${revMonths.length} th√°ng</span></div><div style="padding:14px 18px">`;
  if(!revMonths.length){h+='<div style="color:var(--t2);font-size:12px;text-align:center;padding:14px">Ch∆∞a c√≥ d·ªØ li·ªáu. Nh·∫≠p Gi√° Thu khi th√™m h·ªçc vi√™n.</div>';}
  else{revMonths.forEach(m=>{const pct=Math.round(m.rev/maxRev*100);const rv=m.rev>=1000000?(m.rev/1000000).toFixed(1)+'tr':m.rev>=1000?(m.rev/1000).toFixed(0)+'k':m.rev+'';h+=`<div class="rev-row"><div class="rev-lbl">${m.mk}</div><div class="rev-track"><div class="rev-bar" data-w="${pct}">${rv}</div></div><div class="rev-val">${m.rev.toLocaleString('vi-VN')}ƒë</div></div>`;});}
  h+=`</div></div>`;
  document.getElementById('tkp').innerHTML=h;
  setTimeout(()=>document.querySelectorAll('.rev-bar[data-w]').forEach(b=>{b.style.width=b.dataset.w+'%';}),80);
}

function mkAlertCard(type,list,icon,title,col,bdrCol,bgCol){
  const has=list.length>0;
  const clickAttr=has?`onclick="openAM('${type}')" style="cursor:pointer"`:'style="cursor:default"';
  let card=`<div ${clickAttr} class="alert-card s-card" style="border:1.5px solid ${has?bdrCol:'var(--border)'}">
    <div style="position:absolute;top:0;left:0;right:0;height:3px;background:${has?col:'var(--border2)'};border-radius:var(--rl) var(--rl) 0 0"></div>
    <div style="padding:16px 18px">
    <div style="display:flex;align-items:center;gap:12px">
      <div style="font-size:26px">${icon}</div>
      <div style="flex:1">
        <div style="font-family:var(--fh);font-size:28px;font-weight:800;color:${has?col:'var(--t3)'};line-height:1">${list.length}</div>
        <div style="font-size:12px;color:var(--t1);margin-top:3px;font-weight:500">${title}</div>
      </div>
      ${has?`<div style="width:32px;height:32px;border-radius:50%;background:${bgCol};border:1.5px solid ${bdrCol};display:flex;align-items:center;justify-content:center;font-size:14px;color:${col};flex-shrink:0">‚Ä∫</div>`:''}
    </div>`;
  if(has){
    card+=`<div style="margin-top:10px;display:flex;flex-wrap:wrap;gap:5px">`;
    list.slice(0,3).forEach(r=>{card+=`<span style="background:${bgCol};border:1px solid ${bdrCol};border-radius:99px;padding:3px 10px;font-size:11px;color:${col};font-weight:600;max-width:110px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;display:inline-block">${esc(r.ten)}</span>`;});
    if(list.length>3) card+=`<span style="background:var(--bg-input);border:1px solid var(--border2);border-radius:99px;padding:3px 10px;font-size:11px;color:var(--t2);font-weight:600">+${list.length-3}</span>`;
    card+=`</div>`;
  }
  card+=`</div></div>`;return card;
}

// ‚îÄ‚îÄ MODAL ALERT ‚îÄ‚îÄ
function openAM(type){
  const isWarn=type==='warn',list=isWarn?tkWarn:tkExp;
  const col=isWarn?'var(--orange)':'var(--red)';
  const bg=isWarn?'var(--orange-soft)':'var(--red-soft)';
  const bdr=isWarn?'rgba(245,158,11,.3)':'rgba(239,68,68,.3)';
  const grad=isWarn?'linear-gradient(90deg,var(--orange),#ffc44a)':'linear-gradient(90deg,var(--red),#ff7050)';
  document.getElementById('am-bar').style.background=grad;
  document.getElementById('am-icon').textContent=isWarn?'‚ö†Ô∏è':'üî¥';
  document.getElementById('am-title').textContent=isWarn?'S·∫Øp h·∫øt h·∫°n trong '+WD+' ng√†y':'ƒê√£ h·∫øt h·∫°n ‚Äî C·∫ßn g·ªçi gia h·∫°n';
  const cnt=document.getElementById('am-cnt');
  cnt.textContent=list.length+' h·ªçc vi√™n';
  cnt.style.cssText=`background:${bg};color:${col};border:1.5px solid ${bdr};border-radius:99px;padding:3px 10px;font-size:11px;font-weight:700;flex-shrink:0`;
  let rows='';
  list.forEach(r=>{
    const val=isWarn?r.con_lai:Math.abs(r.con_lai),label=isWarn?'ng√†y c√≤n':'ng√†y qu√°',prefix=isWarn?'':'+';
    const urgent=isWarn&&r.con_lai<=2;
    const iCol=urgent?'var(--red)':col,iBg=urgent?'var(--red-soft)':bg,iBdr=urgent?'rgba(239,68,68,.3)':bdr;
    rows+=`<div class="am-row">
      <div style="width:28px;flex-shrink:0;font-size:11px;color:var(--t2);font-weight:700">#${r.id}</div>
      <div style="flex:1;min-width:0">
        <div onclick="jumpToDashboard(${r.id})" style="font-weight:700;font-size:13px;color:${isWarn?'var(--t0)':'var(--red)'};cursor:pointer;text-decoration:underline;text-underline-offset:2px">${esc(r.ten)} ‚Üó</div>
        <div style="font-size:12px;color:var(--t1);margin-top:2px">${esc(r.sdt||'‚Äî')}</div>
        <div style="font-size:11px;color:var(--t2);margin-top:2px">HH: ${fmtD(r.ngay_hh)}</div>
      </div>
      <div style="flex-shrink:0;width:68px;text-align:center;background:${iBg};border:1.5px solid ${iBdr};border-radius:10px;padding:7px 5px">
        <div style="font-family:var(--fh);font-size:20px;font-weight:800;color:${iCol};line-height:1">${prefix}${val}</div>
        <div style="font-size:9.5px;color:${iCol};opacity:.75;margin-top:2px">${label}</div>
      </div>
    </div>`;
  });
  document.getElementById('am-body').innerHTML=rows||'<div style="padding:32px;text-align:center;color:var(--t2)">Kh√¥ng c√≥ d·ªØ li·ªáu</div>';
  document.getElementById('am').classList.add('show');
}
function closeAM(){document.getElementById('am').classList.remove('show');}

function jumpToDashboard(id){
  closeAM();showPage('dashboard');
  setTimeout(()=>{
    selRow(id);
    const tr=document.querySelector(`tbody tr[data-id="${id}"]`);
    if(tr){tr.scrollIntoView({behavior:'smooth',block:'center'});tr.style.transition='box-shadow .2s';tr.style.boxShadow='0 0 0 2.5px var(--purple)';setTimeout(()=>{tr.style.boxShadow='';},2200);}
  },130);
}

// ‚îÄ‚îÄ BI·∫æN ƒê·ªòNG ‚îÄ‚îÄ
function fmtMKFull(y,m){return 'T'+String(m+1).padStart(2,'0')+'-'+y;}
let bdThisY=new Date().getFullYear(),bdThisM=new Date().getMonth();
let bdPrevY,bdPrevM;
function bdRecalcPrev(){bdPrevM=bdThisM===0?11:bdThisM-1;bdPrevY=bdThisM===0?bdThisY-1:bdThisY;}
bdRecalcPrev();
function bdPopulateMonthSel(){}
function bdGoToday(){const n=new Date();bdThisY=n.getFullYear();bdThisM=n.getMonth();bdRecalcPrev();renderBD();}
function bdChangeThis(d){bdThisM+=d;if(bdThisM>11){bdThisM=0;bdThisY++;}if(bdThisM<0){bdThisM=11;bdThisY--;}bdRecalcPrev();renderBD();}
function bdChangePrev(d){bdPrevM+=d;if(bdPrevM>11){bdPrevM=0;bdPrevY++;}if(bdPrevM<0){bdPrevM=11;bdPrevY--;}renderBD();}

function renderBD(){
  const s_this=new Date(bdThisY,bdThisM,1),e_this=new Date(bdThisY,bdThisM+1,0,23,59,59);
  const s_prev=new Date(bdPrevY,bdPrevM,1),e_prev=new Date(bdPrevY,bdPrevM+1,0,23,59,59);
  const lblThis=fmtMKFull(bdThisY,bdThisM),lblPrev=fmtMKFull(bdPrevY,bdPrevM);
  const now=new Date();
  const isThisNow=bdThisY===now.getFullYear()&&bdThisM===now.getMonth();
  const isPrevNow=bdPrevY===now.getFullYear()&&bdPrevM===now.getMonth();
  function inRange(d,s,e){return d instanceof Date&&!isNaN(d)&&d>=s&&d<=e;}
  const newThis=recs.filter(r=>inRange(r.ngay_bd,s_this,e_this));
  const newPrev=recs.filter(r=>inRange(r.ngay_bd,s_prev,e_prev));
  const stopThis=recs.filter(r=>(r.tt==='expired'||r.tt==='paused')&&inRange(r.ngay_hh,s_this,e_this));
  const stopPrev=recs.filter(r=>(r.tt==='expired'||r.tt==='paused')&&inRange(r.ngay_hh,s_prev,e_prev));
  const activeNow=recs.filter(r=>r.tt==='active'||r.tt==='warning');

  function kpiBox(label,valThis,valPrev,kc){
    const d=valThis-valPrev,sign=d>0?'+':'',dCol=d>0?'var(--green)':d<0?'var(--red)':'var(--t2)',arrow=d>0?'‚ñ≤':d<0?'‚ñº':'‚Äî';
    return `<div class="kpi-card" style="--kc:${kc}">
      <div style="font-size:10px;color:var(--t2);text-transform:uppercase;letter-spacing:1.5px;font-weight:700;padding-left:8px">${label}</div>
      <div style="display:flex;align-items:flex-end;gap:10px;margin-top:6px;padding-left:8px">
        <div style="font-family:var(--fh);font-size:28px;font-weight:800;color:${kc};line-height:1">${valThis}</div>
        <div style="font-size:11px;padding-bottom:3px">
          <div style="color:var(--t2)">Th√°ng so s√°nh: ${valPrev}</div>
          <div style="color:${dCol};font-weight:700">${arrow} ${sign}${d}</div>
        </div>
      </div>
    </div>`;
  }
  function memberRow(r){
    const tag=getTag(r);
    const tCol={active:'var(--green)',warning:'var(--orange)',expired:'var(--red)',paused:'var(--gray)'};
    const tLbl={active:'Ho·∫°t ƒë·ªông',warning:'S·∫Øp HH',expired:'H·∫øt h·∫°n',paused:'T·∫°m d·ª´ng'};
    return `<div class="bd-member">
      <div class="bd-avatar">${getInitials(r.ten)}</div>
      <div style="flex:1;min-width:0">
        <div class="bd-name" onclick="jumpToDashboard(${r.id})">${esc(r.ten)} ‚Üó</div>
        <div style="font-size:11px;color:var(--t2);margin-top:2px">${esc(r.sdt||'‚Äî')} ¬∑ üìÖ ${fmtD(r.ngay_bd)}</div>
      </div>
      <span style="border-radius:99px;padding:3px 10px;font-size:11px;font-weight:600;color:${tCol[tag]};background:${tCol[tag].replace(')',',0.1)').replace('var(--','rgba(')};border:1px solid ${tCol[tag].replace(')',',0.25)').replace('var(--','rgba(')}">${tLbl[tag]}</span>
    </div>`;
  }
  function listBox(title,icon,list,emptyMsg,col,grad){
    return `<div class="s-card">
      <div class="s-card-hdr" style="position:relative;overflow:hidden">
        <div style="position:absolute;top:0;left:0;right:0;height:3px;background:${grad}"></div>
        <span style="font-size:16px">${icon}</span>
        <span class="s-card-title">${title}</span>
        <span class="s-card-badge" style="color:${col}">${list.length} ng∆∞·ªùi</span>
      </div>
      ${list.length?list.map(memberRow).join(''):`<div style="padding:28px;text-align:center;color:var(--t2);font-size:12px">${emptyMsg}</div>`}
    </div>`;
  }
  function monthPickerBox(lbl,isMain,isNow){
    const col=isMain?'var(--purple)':'var(--t1)';
    const bg=isMain?'var(--purple-soft)':'var(--bg-input)';
    const bdr=isMain?'rgba(108,71,255,.35)':'var(--border)';
    const pFn=isMain?'bdChangeThis(-1)':'bdChangePrev(-1)';
    const nFn=isMain?'bdChangeThis(1)':'bdChangePrev(1)';
    return `<div style="background:${bg};border:1.5px solid ${bdr};border-radius:10px;padding:5px 4px;display:flex;align-items:center;gap:3px;user-select:none">
      <button onclick="${pFn}" style="background:none;border:none;color:${col};cursor:pointer;font-size:16px;padding:0 5px;line-height:1;opacity:.6;transition:opacity .15s" onmouseover="this.style.opacity=1" onmouseout="this.style.opacity=.6">‚Äπ</button>
      <div style="text-align:center;min-width:78px">
        <div style="font-family:var(--fh);font-size:16px;font-weight:800;color:${col};line-height:1">${lbl}</div>
        <div style="font-size:8px;color:var(--t2);letter-spacing:1px;margin-top:2px;font-weight:600">${isMain?'TH√ÅNG XEM':'SO S√ÅNH'}${isNow?' ¬∑ NOW':''}</div>
      </div>
      <button onclick="${nFn}" style="background:none;border:none;color:${col};cursor:pointer;font-size:16px;padding:0 5px;line-height:1;opacity:.6;transition:opacity .15s" onmouseover="this.style.opacity=1" onmouseout="this.style.opacity=.6">‚Ä∫</button>
    </div>`;
  }

  let h='';
  h+=`<div class="s-card" style="padding:16px 20px;flex-shrink:0">
    <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px">
      <div><div style="font-family:var(--fh);font-size:15px;font-weight:800;color:var(--t0)">üîÑ Bi·∫øn ƒê·ªông H·ªçc Vi√™n</div>
      <div style="font-size:11px;color:var(--t1);margin-top:3px">Nh·∫•n <b style="color:var(--t0)">‚Äπ ‚Ä∫</b> ƒë·ªÉ ƒë·ªïi th√°ng</div></div>
      <div style="display:flex;gap:8px;align-items:center">
        ${monthPickerBox(lblThis,true,isThisNow)}
        <div style="color:var(--t2);font-size:12px;font-weight:700">vs</div>
        ${monthPickerBox(lblPrev,false,isPrevNow)}
        <button onclick="bdGoToday()" style="background:var(--purple-soft);border:1.5px solid rgba(108,71,255,.3);color:var(--purple);cursor:pointer;font-size:12px;padding:6px 12px;border-radius:8px;font-weight:600;white-space:nowrap" onmouseover="this.style.background='var(--purple-mid)'" onmouseout="this.style.background='var(--purple-soft)'">‚èé H√¥m nay</button>
      </div>
    </div>
  </div>`;
  h+=`<div class="kpi-row" style="display:flex;gap:10px;flex-shrink:0">
    ${kpiBox('H·ªçc vi√™n m·ªõi',newThis.length,newPrev.length,'var(--green)')}
    ${kpiBox('D·ª´ng ho·∫°t ƒë·ªông',stopThis.length,stopPrev.length,'var(--red)')}
    ${kpiBox('ƒêang ho·∫°t ƒë·ªông',activeNow.length,recs.filter(r=>r.ngay_bd instanceof Date&&r.ngay_bd<=e_prev&&(!(r.ngay_hh instanceof Date)||r.ngay_hh>=s_prev)).length,'var(--purple)')}
  </div>`;
  h+=`<div class="bd-grid" style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
    ${listBox('üÜï M·ªõi ‚Äî '+lblThis,'üÜï',newThis,'Th√°ng n√†y ch∆∞a c√≥ h·ªçc vi√™n m·ªõi','var(--green)','linear-gradient(90deg,var(--green),#00d4b0)')}
    ${listBox('üö™ D·ª´ng ‚Äî '+lblThis,'üö™',stopThis,'Th√°ng n√†y ch∆∞a c√≥ ai d·ª´ng','var(--red)','linear-gradient(90deg,var(--red),var(--orange))')}
  </div>`;
  document.getElementById('bdp').innerHTML=h;
}

// ‚îÄ‚îÄ Toast & Status ‚îÄ‚îÄ
let tTimer=null;
function toast(msg,type='ok'){
  const ex=document.querySelector('.toast');if(ex) ex.remove();if(tTimer) clearTimeout(tTimer);
  const cols={ok:'var(--green)',warn:'var(--orange)',err:'var(--red)'};
  const icons={ok:'‚úì',warn:'‚ö†',err:'‚úï'};
  const col=cols[type]||cols.ok;
  const el=document.createElement('div');el.className='toast';
  el.innerHTML=`<div class="tob" style="background:${col}"></div><span style="color:${col};font-size:14px;font-weight:700">${icons[type]||'‚úì'}</span><span style="color:var(--t0)">${msg}</span>`;
  document.body.appendChild(el);
  tTimer=setTimeout(()=>{el.classList.add('hide');setTimeout(()=>el.remove(),280);},3000);
}
function setSt(msg){document.getElementById('smsg').textContent=msg;document.getElementById('stime').textContent=new Date().toLocaleTimeString('vi-VN');}
function tickClock(){
  const n=new Date();
  document.getElementById('clock').textContent=n.toLocaleTimeString('vi-VN');
  document.getElementById('clock-d').textContent=n.toLocaleDateString('vi-VN',{weekday:'short',day:'2-digit',month:'2-digit',year:'numeric'});
}

// Close modals on backdrop
['mf','mc'].forEach(id=>{document.getElementById(id).addEventListener('click',function(e){if(e.target===this){closeForm();closeConfirm();}});});


// ‚îÄ‚îÄ Mobile Sidebar ‚îÄ‚îÄ
function toggleSidebar(){
  const sb=document.querySelector('.sidebar');
  const ov=document.getElementById('sidebar-overlay');
  const hb=document.getElementById('hamburger');
  const open=sb.classList.toggle('open');
  ov.classList.toggle('show',open);
  hb.classList.toggle('open',open);
  document.body.style.overflow=open?'hidden':'';
}
function closeSidebar(){
  document.querySelector('.sidebar').classList.remove('open');
  document.getElementById('sidebar-overlay').classList.remove('show');
  document.getElementById('hamburger').classList.remove('open');
  document.body.style.overflow='';
}
function closeBnActive(){
  document.querySelectorAll('.bn-item').forEach(x=>x.classList.remove('active'));
}

// ‚îÄ‚îÄ Expose to window ‚îÄ‚îÄ

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// IDENTITY / LOGIN
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const USER_KEY = 'gym_user_v1';
const ADMIN_PASS = '0502';
let currentUser = null;
let selectedRole = 'user';

const USER_COLORS = ['#6c47ff','#0ea868','#e0722a','#e03a6a','#0891b2','#7c3aed','#059669','#dc2626'];
function nameToColor(n){ let h=0; for(let i=0;i<n.length;i++) h=(h*31+n.charCodeAt(i))&0xffff; return USER_COLORS[h%USER_COLORS.length]; }
function nameInitials(n){ const w=n.trim().split(' '); return (w.length>1?w[0][0]+w[w.length-1][0]:w[0].slice(0,2)).toUpperCase(); }

function selectRole(r){
  selectedRole = r;
  const btnAdmin = document.getElementById('role-btn-admin');
  const btnUser  = document.getElementById('role-btn-user');
  const passRow  = document.getElementById('admin-pass-row');
  if(btnAdmin) btnAdmin.classList.toggle('selected', r==='admin');
  if(btnUser)  btnUser.classList.toggle('selected',  r==='user');
  // Show password field only for admin
  if(passRow) passRow.style.display = r==='admin' ? 'block' : 'none';
  if(r==='admin'){
    setTimeout(()=>{ const p=document.getElementById('login-pass'); if(p) p.focus(); }, 50);
  }
}

function doLogin(){
  const nameEl = document.getElementById('login-name');
  const passEl = document.getElementById('login-pass');
  const name = nameEl ? nameEl.value.trim() : '';
  if(!name){ if(nameEl) nameEl.focus(); toast('Vui l√≤ng nh·∫≠p t√™n!','warn'); return; }
  // Admin password check
  if(selectedRole === 'admin'){
    const pass = passEl ? passEl.value.trim() : '';
    if(pass !== ADMIN_PASS){
      toast('M·∫≠t kh·∫©u Admin kh√¥ng ƒë√∫ng!','err');
      if(passEl){ passEl.value=''; passEl.focus(); passEl.style.borderColor='var(--red)'; setTimeout(()=>passEl.style.borderColor='',1500); }
      return;
    }
  }
  currentUser = { name, role: selectedRole, color: nameToColor(name) };
  try{ localStorage.setItem(USER_KEY, JSON.stringify(currentUser)); } catch(e){}
  const ov = document.getElementById('login-overlay');
  if(ov) ov.classList.add('hidden');
  updateUserBadge();
  toast('Xin ch√†o, ' + name + (selectedRole==='admin'?' üëë':' üëã'), 'ok');
}

function doLogout(){
  if(!confirm('ƒê·ªïi ng∆∞·ªùi d√πng?\n(D·ªØ li·ªáu kh√¥ng b·ªã ·∫£nh h∆∞·ªüng)')) return;
  currentUser = null;
  try{ localStorage.removeItem(USER_KEY); } catch(e){}
  // Reset form
  const ni = document.getElementById('login-name'); if(ni) ni.value='';
  const pi = document.getElementById('login-pass'); if(pi) pi.value='';
  selectRole('user');
  const ov = document.getElementById('login-overlay');
  if(ov) ov.classList.remove('hidden');
}

function updateUserBadge(){
  if(!currentUser) return;
  const av = document.getElementById('user-avatar');
  const nm = document.getElementById('user-name-display');
  const rl = document.getElementById('user-role-display');
  if(av){ av.textContent=nameInitials(currentUser.name); av.style.background=currentUser.color; }
  if(nm) nm.textContent = currentUser.name;
  if(rl) rl.textContent = currentUser.role==='admin' ? 'üëë Admin' : 'üë§ Nh√¢n vi√™n';
}

function initIdentity(){
  try{
    const saved = localStorage.getItem(USER_KEY);
    if(saved){
      const u = JSON.parse(saved);
      if(u && u.name){ currentUser=u; updateUserBadge(); return; }
    }
  } catch(e){}
  // No saved user ‚Äî show login
  const ov = document.getElementById('login-overlay');
  if(ov) ov.classList.remove('hidden');
  setTimeout(()=>{ const inp=document.getElementById('login-name'); if(inp) inp.focus(); }, 80);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ACTIVITY LOG
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const logRef = ref(fbDB, 'activity_log');
let activityLog = [];
let logFilter = 'all';

function logAct(action, data){
  if(!currentUser) return;
  const entry = {
    id: Date.now()+'_'+Math.random().toString(36).slice(2,6),
    ts: new Date().toISOString(),
    user: currentUser.name, role: currentUser.role, color: currentUser.color,
    action, data,
  };
  activityLog.unshift(entry);
  const entryRef = ref(fbDB, 'activity_log/'+entry.id);
  set(entryRef, entry).catch(e=>console.error('Log save error:',e));
  renderLog();
}

function initLogSync(){
  onValue(logRef, snap=>{
    const raw=snap.val();
    activityLog = raw ? Object.values(raw).sort((a,b)=>b.ts.localeCompare(a.ts)) : [];
    renderLog();
  }, e=>console.error('Log sync error:',e));
}

const ACTION_META = {
  add:        {icon:'‚ûï',label:'Th√™m h·ªçc vi√™n',   bg:'rgba(14,168,104,.1)', col:'var(--green)'},
  edit:       {icon:'‚úèÔ∏è',label:'S·ª≠a h·ªçc vi√™n',    bg:'rgba(108,71,255,.1)',col:'var(--purple)'},
  delete:     {icon:'üóëÔ∏è',label:'X√≥a h·ªçc vi√™n',    bg:'rgba(224,58,106,.1)',col:'var(--red)'},
  update_all: {icon:'üîÅ',label:'C·∫≠p nh·∫≠t t·∫•t c·∫£', bg:'rgba(14,132,168,.1)',col:'#0891b2'},
  holiday:    {icon:'üéâ',label:'B√π ng√†y ngh·ªâ l·ªÖ', bg:'rgba(224,114,42,.1)',col:'var(--orange)'},
  import:     {icon:'üìÇ',label:'Nh·∫≠p d·ªØ li·ªáu',    bg:'rgba(108,71,255,.1)',col:'var(--purple)'},
  undo:       {icon:'‚Ü©Ô∏è',label:'Ho√†n t√°c',         bg:'rgba(74,88,120,.1)', col:'var(--t1)'},
};

function setLogFilter(f){
  logFilter=f;
  document.querySelectorAll('.log-chip').forEach((el,i)=>{
    const map=['all','add','edit','delete','other'];
    el.classList.toggle('active', map[i]===f);
  });
  renderLog();
}

function renderLog(){
  const el=document.getElementById('log-list');
  const cnt=document.getElementById('log-count');
  const clearBtn=document.getElementById('clear-log-btn');
  if(!el) return;
  let filtered=activityLog;
  if(logFilter!=='all'){
    const other=['update_all','holiday','import','undo'];
    filtered = logFilter==='other' ? activityLog.filter(x=>other.includes(x.action)) : activityLog.filter(x=>x.action===logFilter);
  }
  if(cnt) cnt.textContent=filtered.length+' thao t√°c';
  if(clearBtn) clearBtn.style.display=currentUser?.role==='admin'?'':'none';
  if(!filtered.length){
    el.innerHTML=`<div style="display:flex;flex-direction:column;align-items:center;padding:60px 20px;color:var(--t2);gap:10px"><div style="font-size:40px;opacity:.2">üìã</div><div style="font-weight:600">Ch∆∞a c√≥ ho·∫°t ƒë·ªông n√†o</div></div>`;
    return;
  }
  el.innerHTML=filtered.map(entry=>{
    const m=ACTION_META[entry.action]||{icon:'‚öôÔ∏è',label:entry.action,bg:'var(--bg-input)',col:'var(--t2)'};
    const dt=new Date(entry.ts);
    const dateStr=dt.toLocaleDateString('vi-VN',{day:'2-digit',month:'2-digit',year:'numeric'});
    const timeStr=dt.toLocaleTimeString('vi-VN',{hour:'2-digit',minute:'2-digit',second:'2-digit'});
    const canUndo=currentUser?.role==='admin'&&['add','edit','delete'].includes(entry.action);
    const roleBadge=entry.role==='admin'?'<span class="role-admin">Admin</span>':'<span class="role-user">NV</span>';
    let desc='';
    if(entry.data){
      if(entry.action==='add') desc=`Th√™m m·ªõi: <b>${esc(entry.data.ten||'')}</b> ¬∑ ${esc(entry.data.sdt||'‚Äî')} ¬∑ ${entry.data.so_ngay||0} ng√†y`;
      else if(entry.action==='edit'){
        desc=`<b>${esc(entry.data.after?.ten||entry.data.ten||'')}</b>`;
        if(entry.data.changes&&Object.keys(entry.data.changes).length){
          const parts=Object.entries(entry.data.changes).map(([k,v])=>`${k}: <i>${esc(String(v[0]||''))}</i> ‚Üí <b>${esc(String(v[1]||''))}</b>`);
          desc+=' ¬∑ '+parts.slice(0,3).join(', ')+(parts.length>3?'‚Ä¶':'');
        }
      }
      else if(entry.action==='delete') desc=`X√≥a: <b>${esc(entry.data.ten||'')}</b> ¬∑ ${esc(entry.data.sdt||'‚Äî')}`;
      else if(entry.action==='update_all') desc=`C·∫≠p nh·∫≠t ${entry.data.count||0} h·ªçc vi√™n`;
      else if(entry.action==='holiday') desc=`B√π ${entry.data.days||0} ng√†y cho ${entry.data.count||0} h·ªçc vi√™n`;
      else if(entry.action==='import') desc=`Nh·∫≠p ${entry.data.count||0} h·ªçc vi√™n`;
      else if(entry.action==='undo') desc=`Ho√†n t√°c: ${entry.data.what||''}`;
    }
    return `<div class="log-item">
      <div class="log-icon-wrap" style="background:${m.bg}">${m.icon}</div>
      <div class="log-main">
        <div class="log-action">${m.label}</div>
        <div class="log-detail">${desc}</div>
        <div style="display:flex;align-items:center;gap:6px;margin-top:4px">
          <div class="log-who" style="color:${entry.color||'var(--purple)'}">${esc(entry.user||'?')}</div>
          ${roleBadge}
          ${canUndo?`<button class="undo-btn" onclick="undoEntry('${entry.id}')">‚Ü© Ho√†n t√°c</button>`:''}
        </div>
      </div>
      <div class="log-time">${dateStr}<br/>${timeStr}</div>
    </div>`;
  }).join('');
}

function undoEntry(id){
  if(currentUser?.role!=='admin'){toast('Ch·ªâ Admin m·ªõi c√≥ th·ªÉ ho√†n t√°c!','warn');return;}
  const entry=activityLog.find(x=>x.id===id);
  if(!entry){toast('Kh√¥ng t√¨m th·∫•y thao t√°c!','warn');return;}
  if(!confirm('Ho√†n t√°c: '+((ACTION_META[entry.action]||{}).label||entry.action)+' b·ªüi '+entry.user)) return;
  let desc='';
  if(entry.action==='add'){
    const bLen=recs.length;
    recs=recs.filter(r=>!(r.ten===entry.data.ten&&r.sdt===entry.data.sdt));
    if(recs.length===bLen&&entry.data.id) recs=recs.filter(r=>r.id!==entry.data.id);
    recs.forEach((r,i)=>r.id=i+1);
    desc='Ho√†n t√°c th√™m: '+entry.data.ten;
  } else if(entry.action==='delete'){
    const restored=parseRec({...entry.data});
    restored.id=recs.length?Math.max(...recs.map(r=>r.id))+1:1;
    recs.push(restored); recalcAll();
    desc='Ho√†n t√°c x√≥a: '+entry.data.ten;
  } else if(entry.action==='edit'&&entry.data.before){
    const idx=recs.findIndex(r=>r.id===entry.data.before.id);
    if(idx>=0){recs[idx]=parseRec({...entry.data.before});recalc(recs[idx]);}
    desc='Ho√†n t√°c s·ª≠a: '+(entry.data.after?.ten||entry.data.before?.ten||'');
  }
  saveData(); renderTable(); logAct('undo',{what:desc,ref_id:id});
  toast('ƒê√£ ho√†n t√°c th√†nh c√¥ng! ‚Ü©','ok');
}

function clearAllLogs(){
  if(currentUser?.role!=='admin'){toast('Ch·ªâ Admin m·ªõi c√≥ th·ªÉ x√≥a log!','warn');return;}
  if(!confirm('X√≥a to√†n b·ªô l·ªãch s·ª≠ ho·∫°t ƒë·ªông?\nKh√¥ng th·ªÉ ho√†n t√°c!')) return;
  set(logRef,null).catch(e=>console.error(e));
  activityLog=[]; renderLog();
  toast('ƒê√£ x√≥a to√†n b·ªô l·ªãch s·ª≠','warn');
}

Object.assign(window,{
  toggleSidebar,closeSidebar,closeBnActive,
  showPage,openAdd,openEdit,editSel,closeForm,saveForm,
  delSel,delById,closeConfirm,confirmDelete,
  capNhatTatCa,buNgayLe,exportData,importData,handleImport,
  sortBy,selRow,renderTable,setChip,
  openAM,closeAM,jumpToDashboard,
  doLogin,doLogout,selectRole,
  setLogFilter,renderLog,undoEntry,clearAllLogs,
  renderTK,renderBD,bdGoToday,bdPopulateMonthSel,bdChangeThis,bdChangePrev,
});

// ‚îÄ‚îÄ PWA: Service Worker ‚îÄ‚îÄ
if('serviceWorker' in navigator){
  window.addEventListener('load',()=>{
    navigator.serviceWorker.register('./sw.js').then(reg=>{
      console.log('[PWA] SW registered:',reg.scope);
    }).catch(err=>console.warn('[PWA] SW failed:',err));
  });
}

// ‚îÄ‚îÄ PWA: Install prompt ‚îÄ‚îÄ
let deferredPrompt=null;
window.addEventListener('beforeinstallprompt',e=>{
  e.preventDefault();deferredPrompt=e;
  const banner=document.getElementById('pwa-banner');
  if(banner&&!localStorage.getItem('pwa-dismissed')) banner.classList.add('show');
});
document.getElementById('pwa-install-btn')?.addEventListener('click',async()=>{
  if(!deferredPrompt) return;
  deferredPrompt.prompt();
  const{outcome}=await deferredPrompt.userChoice;
  if(outcome==='accepted') toast('HUY GYM ƒë√£ ƒë∆∞·ª£c c√†i ƒë·∫∑t! üì±','ok');
  deferredPrompt=null;
  document.getElementById('pwa-banner').classList.remove('show');
});
document.getElementById('pwa-dismiss-btn')?.addEventListener('click',()=>{
  document.getElementById('pwa-banner').classList.remove('show');
  localStorage.setItem('pwa-dismissed','1');
});

// ‚îÄ‚îÄ Online/Offline banner ‚îÄ‚îÄ
function updateOnlineStatus(){
  const bar=document.getElementById('offline-bar');
  if(!navigator.onLine){bar.classList.add('show');}
  else{bar.classList.remove('show');}
}
window.addEventListener('online',updateOnlineStatus);
window.addEventListener('offline',updateOnlineStatus);
updateOnlineStatus();

// ‚îÄ‚îÄ Init ‚îÄ‚îÄ
setSt('ƒêang k·∫øt n·ªëi Firebase‚Ä¶');
setInterval(tickClock,1000);tickClock();
initFirebaseSync();
initLogSync();
</script>

<!-- ‚ïê‚ïê BOTTOM NAV (mobile) ‚ïê‚ïê -->
<nav class="bottom-nav" id="bottom-nav">
  <div class="bn-item active" id="bn-dashboard" onclick="showPage('dashboard');closeBnActive();this.classList.add('active')">
    <div class="bn-icon">üìä</div>
    <div>Dashboard</div>
  </div>
  <div class="bn-compose" onclick="openAdd()">
    <span class="bn-compose-icon">‚úèÔ∏è</span>
    <span class="bn-compose-label">Th√™m h·ªçc vi√™n</span>
  </div>
  <div class="bn-item" id="bn-thongke" onclick="showPage('thongke');closeBnActive();this.classList.add('active')">
    <div class="bn-icon">üìà</div>
    <div>Th·ªëng k√™</div>
  </div>
</nav>


<!-- ‚ïê‚ïê LOGIN OVERLAY ‚ïê‚ïê -->
<div class="login-overlay hidden" id="login-overlay">
  <div class="login-box">
    <div class="login-logo">üèãÔ∏è</div>
    <div class="login-title">HUY GYM</div>
    <div class="login-sub">Nh·∫≠p t√™n c·ªßa b·∫°n ƒë·ªÉ b·∫Øt ƒë·∫ßu s·ª≠ d·ª•ng</div>
    <input class="login-name-input" id="login-name"
      placeholder="V√≠ d·ª•: Huy, Lan, Minh‚Ä¶" maxlength="30"
      onkeydown="if(event.key==='Enter')doLogin()"/>
    <div class="login-role-row">
      <button class="login-role-btn" id="role-btn-admin" onclick="selectRole('admin')">
        <span class="lrb-icon">üëë</span>
        Admin
        <div style="font-size:9px;color:var(--t2);font-weight:400;margin-top:2px">To√†n quy·ªÅn</div>
      </button>
      <button class="login-role-btn selected" id="role-btn-user" onclick="selectRole('user')">
        <span class="lrb-icon">üë§</span>
        Nh√¢n vi√™n
        <div style="font-size:9px;color:var(--t2);font-weight:400;margin-top:2px">Xem + ch·ªânh s·ª≠a</div>
      </button>
    </div>
    <div id="admin-pass-row" style="display:none;margin-bottom:14px">
      <input class="login-name-input" id="login-pass" type="password"
        placeholder="Nh·∫≠p m·∫≠t kh·∫©u Admin‚Ä¶"
        onkeydown="if(event.key==='Enter')doLogin()"
        style="margin-bottom:0"/>
    </div>
    <button class="login-enter-btn" onclick="doLogin()">V√†o h·ªá th·ªëng ‚Üí</button>
    <div style="font-size:10px;color:var(--t2);margin-top:14px">T√™n s·∫Ω ƒë∆∞·ª£c l∆∞u tr√™n thi·∫øt b·ªã n√†y</div>
  </div>
</div>
</body>
</html>
